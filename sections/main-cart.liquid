<div class="cart-page">
  <div class="cart-page__header">
    <h1>{{ 'cart.general.title' | t }}</h1>
    {%- if cart.item_count > 0 -%}
      <span class="cart-page__count">{{ cart.item_count }} {{ cart.item_count | pluralize: 'item', 'items' }}</span>
    {%- endif -%}
  </div>

  {% if cart.item_count > 0 %}
    <!-- Free Shipping Progress Bar -->
    {%- assign free_shipping_threshold = 5000 -%}
    {%- assign remaining = free_shipping_threshold | minus: cart.total_price -%}
    {%- if remaining > 0 -%}
      {%- assign progress_pct = cart.total_price | times: 100 | divided_by: free_shipping_threshold -%}
      <div class="cart-shipping-bar">
        <div class="cart-shipping-bar__text">
          <span style="font-size: 16px; margin-right: 4px;">‚ú®</span>
          <span>Add <strong>{{ remaining | money }}</strong> more for <strong>complimentary shipping</strong></span>
        </div>
        <div class="cart-shipping-bar__track">
          <div class="cart-shipping-bar__fill" style="width: {{ progress_pct }}%;"></div>
        </div>
      </div>
    {%- else -%}
      <div class="cart-shipping-bar cart-shipping-bar--achieved">
        <span style="font-size: 16px; margin-right: 4px;">‚ú®</span>
        <span>Your keepsake qualifies for <strong>complimentary shipping</strong></span>
      </div>
    {%- endif -%}

    <div class="cart-page__content">
      <div class="cart-page__items-container">
        {% for item in cart.items %}
          <div class="cart-page__item">
            <div class="cart-page__item-img">
              {% if item.image %}
                <a href="{{ item.url }}">
                  <img src="{{ item.image | image_url: width: 200 }}" alt="{{ item.image.alt | escape }}">
                </a>
              {% endif %}
            </div>
            <div class="cart-page__item-details">
              <a href="{{ item.url }}" class="cart-page__item-title">{{ item.product.title }}</a>
              {% unless item.variant.title == 'Default Title' %}
                <p class="cart-page__item-variant">{{ item.variant.title }}</p>
              {% endunless %}
              <p class="cart-page__item-price">
                {%- if item.variant.compare_at_price > item.variant.price -%}
                  <span class="cart-price-sale">{{ item.price | money }}</span>
                  <span class="cart-price-compare">{{ item.variant.compare_at_price | money }}</span>
                {%- else -%}
                  <span class="cart-price-sale">{{ item.price | money }}</span>
                {%- endif -%}
              </p>
              <div class="cart-page__item-qty">
                <a href="/cart/change?id={{ item.key }}&quantity={{ item.quantity | minus: 1 }}" aria-label="Decrease quantity">
                  <button class="cart-qty-btn" type="button"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/></svg></button>
                </a>
                <span class="cart-qty-num">{{ item.quantity }}</span>
                <a href="/cart/change?id={{ item.key }}&quantity={{ item.quantity | plus: 1 }}" aria-label="Increase quantity">
                  <button class="cart-qty-btn" type="button"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg></button>
                </a>
              </div>
            </div>
            <div class="cart-page__item-total">
              <span class="cart-item-line-price">{{ item.line_price | money }}</span>
              <a href="javascript:void(0)" class="cart-page__remove" aria-label="Remove item"
                 data-remove-url="/cart/change?id={{ item.key }}&quantity=0"
                 data-remove-title="{{ item.title | escape }}"
                 data-remove-img="{{ item.image | image_url: width: 200 }}">
                <span class="cart-remove-text">Remove</span>
              </a>
            </div>
          </div>
        {% endfor %}



        <!-- Complete the Vow - Upsell Carousel -->
        <div class="cart-page__promos">
          {%- assign upsell_collection = collections['all'] -%}
          {%- assign upsell_shown = 0 -%}
          {%- assign has_upsell = false -%}
          {%- for p in upsell_collection.products limit: 20 -%}
            {%- assign is_in_cart = false -%}
            {%- for item in cart.items -%}
              {%- if item.product_id == p.id -%}{%- assign is_in_cart = true -%}{%- endif -%}
            {%- endfor -%}
            {%- unless is_in_cart -%}
              {%- if p.available -%}{%- assign has_upsell = true -%}{%- endif -%}
            {%- endunless -%}
          {%- endfor -%}

          {%- if has_upsell -%}
            <div class="cart-upsell">
              <div class="cart-upsell__header">
                <h3>Complete the Vow</h3>
                <p>Complementary pieces to elevate your gift</p>
              </div>
              <div class="cart-upsell__carousel">
                {%- for p in upsell_collection.products limit: 20 -%}
                  {%- if upsell_shown >= 4 -%}{%- break -%}{%- endif -%}
                  {%- assign is_in_cart = false -%}
                  {%- for item in cart.items -%}
                    {%- if item.product_id == p.id -%}{%- assign is_in_cart = true -%}{%- endif -%}
                  {%- endfor -%}
                  {%- unless is_in_cart -%}
                    {%- if p.available -%}
                      <div class="cart-upsell__slide">
                        <a href="{{ p.url }}" class="cart-upsell__img-wrap">
                          <img src="{{ p.featured_image | image_url: width: 300 }}" alt="{{ p.title | escape }}">
                        </a>
                        <div class="cart-upsell__info">
                           <a href="{{ p.url }}" class="cart-upsell__title">{{ p.title | truncate: 40 }}</a>
                           <div class="cart-upsell__price">
                             <span class="cart-upsell__price-current">{{ p.price | money }}</span>
                             {%- if p.compare_at_price > p.price -%}
                               <span class="cart-upsell__price-compare">{{ p.compare_at_price | money }}</span>
                             {%- endif -%}
                           </div>
                        </div>
                        <form action="/cart/add" method="post" style="margin:0;">
                          <input type="hidden" name="id" value="{{ p.first_available_variant.id }}">
                          <input type="hidden" name="quantity" value="1">
                          <button type="submit" class="cart-upsell__add">+ Add</button>
                        </form>
                      </div>
                      {%- assign upsell_shown = upsell_shown | plus: 1 -%}
                    {%- endif -%}
                  {%- endunless -%}
                {%- endfor -%}
              </div>
            </div>
          {%- endif -%}
        </div>
      </div>

      <div class="cart-page__summary">
        <div class="cart-page__summary-card">
          <h3>Order Summary</h3>
          
          <!-- Order Protection -->
          <label class="cdraw-protect">
            <div class="cdraw-protect__info">
              <div class="cdraw-protect__title">Protect Your Keepsake</div>
              <div class="cdraw-protect__desc">Comprehensive coverage for love's journey ‚Äî <span class="cdraw-protect__price">$4.20</span></div>
            </div>
            <input type="checkbox" id="order-protection-checkbox" style="display:none;" onchange="this.parentElement.classList.toggle('active', this.checked); updateCartTotals();">
            <div class="cdraw-protect__toggle"></div>
          </label>
          <input type="hidden" form="cart" name="attributes[Order Protection]" value="Yes, $4.20" id="order-protection-attribute" disabled>

          <div class="cart-page__summary-row">
            <span>{{ 'cart.general.subtotal' | t }}</span>
            <strong id="cart-subtotal" data-base-total="{{ cart.total_price }}">{{ cart.total_price | money }}</strong>
          </div>
          <div class="cart-page__summary-row cart-page__summary-shipping">
            <span>Shipping</span>
            <span class="cart-shipping-free">Complimentary</span>
          </div>
          <div class="cart-page__summary-divider"></div>
          <div class="cart-page__summary-row cart-page__summary-total">
            <span>Total</span>
            <strong id="cart-final-total" data-base-total="{{ cart.total_price }}">{{ cart.total_price | money }}</strong>
          </div>

          <!-- Checkout -->
          <div class="cart-page__checkout-container">
            <a href="/checkout" class="cart-page__checkout-btn" name="checkout">
              Finalize Your Gift
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </a>
          </div>

          <!-- Express Checkout -->
          <div class="cart-express">
            <span class="cart-express__label">Express Checkout</span>
            <div class="cart-express__buttons">
              {% if additional_checkout_buttons %}
                <div class="additional-checkout-buttons">
                  {{ content_for_additional_checkout_buttons }}
                </div>
              {% endif %}
            </div>
          </div>

          <!-- Payment Icons (Monochrome) -->
          <div class="cdraw-payments">
            <span class="cdraw-payment-icon" title="Visa"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#1A1F71"/><text x="24" y="20" text-anchor="middle" fill="#FFFFFF" font-size="11" font-weight="700" font-family="Arial">VISA</text></svg></span>
            <span class="cdraw-payment-icon" title="Mastercard"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#252525"/><circle cx="19" cy="16" r="9" fill="#EB001B"/><circle cx="29" cy="16" r="9" fill="#F79E1B"/><path d="M24 9.5a9 9 0 0 1 0 13" fill="#FF5F00"/></svg></span>
            <span class="cdraw-payment-icon" title="American Express"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#006FCF"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="7" font-weight="700" font-family="Arial">AMEX</text></svg></span>
            <span class="cdraw-payment-icon" title="PayPal"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#003087"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="8" font-weight="700" font-family="Arial">PayPal</text></svg></span>
            <span class="cdraw-payment-icon" title="Apple Pay"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#000000"/><text x="24" y="19" text-anchor="middle" fill="#FFFFFF" font-size="8" font-weight="500" font-family="Arial"> Pay</text></svg></span>
          </div>

          <!-- Trust Badges (Monochrome) -->
          <div class="cdraw-trust">
            <div class="cdraw-trust__item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M9 12l2 2 4-4"/></svg>
              <span class="cdraw-trust__text">Secure<br>Checkout</span>
            </div>
            <div class="cdraw-trust__item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
              <span class="cdraw-trust__text">Fully Insured<br>Shipping</span>
            </div>
            <div class="cdraw-trust__item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
              <span class="cdraw-trust__text">Lifetime<br>Warranty</span>
            </div>
          </div>

          <div class="cart-page__continue-wrap">
            <a href="{{ routes.all_products_collection_url }}" class="cart-page__continue">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
              Continue Shopping
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Quality Backed By Our Warranty -->
    <div class="cart-warranty">
      <div class="cart-warranty__strip">
        <div class="cart-warranty__img"><img src="{{ 'quality-warranty-1.jpg' | asset_url }}" alt="Jewelry Craftsmanship" loading="lazy"></div>
        <div class="cart-warranty__img"><img src="{{ 'quality-warranty-2.jpg' | asset_url }}" alt="Jewelry Details" loading="lazy"></div>
        <div class="cart-warranty__img"><img src="{{ 'quality-warranty-3.jpg' | asset_url }}" alt="Wearing Jewelry" loading="lazy"></div>
      </div>
      <div class="cart-warranty__body">
        <span class="cart-warranty__label">OUR PROMISE</span>
        <h3 class="cart-warranty__heading">Quality Backed By Our Warranty</h3>
        <p class="cart-warranty__text">Every piece is meticulously crafted from sterling silver, offered in 14K gold and silver finishes.<br>Hypoallergenic, lead and nickel-free ‚Äî designed to last a lifetime.</p>
        <div class="cart-warranty__features">
          <div class="cart-warranty__feature">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#E11D48" stroke-width="1"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M9 12l2 2 4-4"/></svg>
            <span>Lifetime Warranty</span>
          </div>
          <div class="cart-warranty__feature">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#E11D48" stroke-width="1"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
            <span>Hypoallergenic</span>
          </div>
          <div class="cart-warranty__feature">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#E11D48" stroke-width="1"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
            <span>Insured Shipping</span>
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <div class="cart-page__empty">
      <div style="font-size: 64px; margin-bottom: 16px;">üõçÔ∏è</div>
      <p class="cart-empty-heading">Your cart is empty</p>
      <p class="cart-empty-text">Discover something special for your loved ones.</p>
      <a href="{{ routes.all_products_collection_url }}" class="cart-page__checkout-btn" style="max-width: 300px; margin: 0 auto;">Continue Shopping</a>
    </div>
  {% endif %}
</div>

<!-- Sticky Checkout Bar -->
<div class="cart-sticky-bar" id="cart-sticky-bar">
  <div class="cart-sticky-bar__inner">
    <div class="cart-sticky-bar__left">
      <div class="cart-sticky-bar__total">Total: <strong>{{ cart.total_price | money }}</strong></div>
      <div class="cart-sticky-bar__warranty">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        LIFETIME WARRANTY
      </div>
    </div>
    <div class="cart-sticky-bar__center">
      <div class="cart-sticky-bar__secure">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        100% SECURE CHECKOUT
      </div>
      <div class="cart-sticky-bar__icons">
        <span class="cart-sticky-icon" title="Visa"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#1A1F71"/><text x="24" y="20" text-anchor="middle" fill="#FFF" font-size="11" font-weight="700" font-family="Arial">VISA</text></svg></span>
        <span class="cart-sticky-icon" title="Mastercard"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#252525"/><circle cx="19" cy="16" r="9" fill="#EB001B"/><circle cx="29" cy="16" r="9" fill="#F79E1B"/></svg></span>
        <span class="cart-sticky-icon" title="American Express"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#006FCF"/><text x="24" y="18" text-anchor="middle" fill="#FFF" font-size="7" font-weight="700" font-family="Arial">AMEX</text></svg></span>
        <span class="cart-sticky-icon" title="Apple Pay"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#000"/><text x="24" y="19" text-anchor="middle" fill="#FFF" font-size="8" font-weight="500" font-family="Arial"> Pay</text></svg></span>
        <span class="cart-sticky-icon" title="PayPal"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#003087"/><text x="24" y="18" text-anchor="middle" fill="#FFF" font-size="8" font-weight="700" font-family="Arial">PayPal</text></svg></span>
      </div>
    </div>
    <div class="cart-sticky-bar__actions">
      <a href="/checkout" class="cart-page__checkout-btn cart-sticky-bar__btn" name="checkout">
        Finalize Your Gift
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
      </a>
    </div>
  </div>
</div>

<style>
  /* Typography ‚Äî uses design system variables from base.css */

  /* ===== Cart Page: Quiet Luxury ===== */
  .cart-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 32px 24px;
    padding-bottom: 110px; /* Offset for sticky bar on mobile */
  }
  @media (min-width: 750px) {
    .cart-page { padding: 48px 40px; padding-bottom: 48px; /* Reset on desktop if no sticky bar, or match default */ }
  }
  @media (max-width: 749px) {
    .cart-page { padding: 24px 16px; padding-bottom: 120px; /* Stronger offset for mobile sticky bar */ }
  }
  
  .cart-page__header { 
    display: flex; align-items: baseline; gap: 12px; 
    margin-bottom: 20px; padding-bottom: 16px;
    border-bottom: 1px solid rgba(29,29,29,0.08);
  }
  @media (min-width: 750px) { .cart-page__header { gap: 16px; margin-bottom: 32px; } }

  .cart-page__header h1 {
    font-family: var(--font-heading);
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 400; color: var(--color-text); margin: 0; line-height: 1.2;
  }
  .cart-page__count {
    font-family: var(--font-body);
    font-size: 13px; font-weight: 500; color: rgba(29,29,29,0.55);
    text-transform: uppercase; letter-spacing: 1px;
  }

  /* ===== 2-Column Layout ===== */
  .cart-page__content { display: grid; grid-template-columns: 1fr; gap: 32px; align-items: start; }
  @media (min-width: 992px) { .cart-page__content { grid-template-columns: 1fr 420px; gap: 40px; } }

  .cart-page__items-container {
    background: transparent;
    border-radius: 16px;
    padding: 0;
  }

  /* ===== Cart Items ===== */
  .cart-page__item {
    display: flex; gap: 16px; padding: 20px 0;
    border-bottom: 1px solid rgba(29,29,29,0.06);
    position: relative;
  }
  @media (min-width: 750px) { .cart-page__item { gap: 24px; padding: 24px 0; } }
  
  .cart-page__item:first-child { padding-top: 0; }
  .cart-page__item:last-child { border-bottom: none; padding-bottom: 0; }
  
  .cart-page__item-img { 
    width: 90px; height: 90px; 
    border-radius: 10px; overflow: hidden; 
    flex-shrink: 0; background: var(--color-bg-warm);
  }
  @media (min-width: 750px) { .cart-page__item-img { width: 130px; height: 130px; border-radius: 12px; } }
  .cart-page__item-img img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
  .cart-page__item-img:hover img { transform: scale(1.05); }

  .cart-page__item-details { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: space-between; padding-top: 0; }
  .cart-page__item-title { 
    font-family: var(--font-heading);
    font-size: 17px; font-weight: 600; color: var(--color-text);
    margin-bottom: 4px; line-height: 1.25; text-decoration: none;
    display: inline-block; transition: color 0.3s ease;
  }
  @media (min-width: 750px) { .cart-page__item-title { font-size: 20px; margin-bottom: 8px; line-height: 1.3; } }
  
  .cart-page__item-title:hover { color: var(--color-sale); }
  .cart-page__item-variant {
    font-family: var(--font-body);
    font-size: 12px; color: rgba(29,29,29,0.55); margin-bottom: 8px; letter-spacing: 0.5px;
  }
  @media (min-width: 750px) { .cart-page__item-variant { font-size: 13px; margin-bottom: 12px; } }
  
  .cart-page__item-price { font-size: 15px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
  @media (min-width: 750px) { .cart-page__item-price { font-size: 16px; margin-bottom: 16px; } }
  .cart-price-sale { font-family: var(--font-body); font-weight: 700; color: var(--color-sale); font-size: 1em; }
  .cart-price-compare { font-family: var(--font-body); font-weight: 500; text-decoration: line-through; color: #B4B4B4; font-size: 0.85em; }
  
  .cart-page__item-qty {
    display: flex; align-items: center; border: 1px solid rgba(29,29,29,0.1); 
    border-radius: 50px; width: fit-content; height: 36px; overflow: hidden;
    background: #F9F8F3;
  }
  @media (min-width: 750px) { .cart-page__item-qty { height: 40px; } }
  .cart-page__item-qty a { text-decoration: none; height: 100%; display: flex; align-items: center; justify-content: center; }
  .cart-qty-btn {
    width: 32px; height: 100%; display: flex; align-items: center; justify-content: center;
    background: transparent; border: none; font-size: 16px;
    cursor: pointer; color: #2D1B2E; transition: all 0.2s;
  }
  @media (min-width: 750px) { .cart-qty-btn { width: 36px; font-size: 18px; } }
  .cart-qty-btn:hover { color: #E11D48; background: rgba(29,29,29,0.04); }
  .cart-qty-num {
    display: flex; align-items: center; justify-content: center;
    min-width: 36px; height: 100%; text-align: center;
    font-family: var(--font-body);
    font-size: 14px; font-weight: 600; color: #2D1B2E;
    border-left: 1px solid rgba(45,27,46,0.06);
    border-right: 1px solid rgba(45,27,46,0.06);
  }
  @media (min-width: 750px) { .cart-qty-num { min-width: 40px; font-size: 15px; } }
  
  .cart-page__item-total { display: flex; flex-direction: column; align-items: flex-end; justify-content: space-between; min-width: 100px; padding-top: 4px; }
  .cart-item-line-price { font-family: var(--font-body); font-size: 18px; font-weight: 600; color: var(--color-text); letter-spacing: 0.5px; }
  .cart-page__remove {
    font-family: var(--font-body);
    font-size: 12px; font-weight: 500;
    color: #999; transition: all 0.3s ease; text-decoration: none;
    display: inline-block; padding: 4px 0; border-bottom: 1px solid transparent;
  }
  .cart-remove-text { text-transform: capitalize; font-style: italic; text-decoration: underline; text-underline-offset: 3px; }
  .cart-page__remove:hover .cart-remove-text { color: var(--color-sale); }

  /* ===== Love Note Module ===== */
  .cart-love-note {
    margin-top: 32px; padding-top: 32px;
    border-top: 1px solid rgba(29,29,29,0.06);
  }
  .cart-love-note__header {
    display: flex; align-items: center; gap: 10px; margin-bottom: 14px;
  }
  .cart-love-note__header h4 {
    font-family: var(--font-heading);
    font-size: 18px; font-weight: 500; color: var(--color-text); margin: 0;
  }
  .cart-love-note__header h4 span {
    font-family: var(--font-body);
    font-size: 11px; font-weight: 400; color: rgba(29,29,29,0.4);
  }
  .cart-love-note__input {
    width: 100%; padding: 16px; border: 1px dashed #776B63; border-radius: 12px;
    background: transparent; font-family: var(--font-body);
    font-size: 13px; color: var(--color-text); line-height: 1.6; resize: vertical;
    transition: border-color 0.3s;
  }
  .cart-love-note__input::placeholder { color: rgba(29,29,29,0.3); font-style: italic; }
  .cart-love-note__input:focus { outline: none; border-color: var(--color-accent-warm); border-style: solid; }
  .cart-love-note__counter {
    text-align: right; font-family: var(--font-body);
    font-size: 11px; color: rgba(29,29,29,0.3); margin-top: 6px;
  }

  /* ===== Gift Wrapping ===== */
  .cart-gift-wrap {
    display: flex; align-items: center; gap: 14px;
    padding: 16px 20px; margin-top: 16px;
    border: 1px solid rgba(29,29,29,0.08); border-radius: 12px;
    cursor: pointer; transition: all 0.3s;
    background: transparent;
  }
  .cart-gift-wrap:hover { border-color: rgba(29,29,29,0.15); }
  .cart-gift-wrap.active { border-color: var(--color-accent-warm); background: rgba(139,115,85,0.04); }
  .cart-gift-wrap__check {
    width: 22px; height: 22px; border-radius: 6px;
    border: 1.5px solid rgba(29,29,29,0.2);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0; transition: all 0.2s; color: transparent;
  }
  .cart-gift-wrap.active .cart-gift-wrap__check {
    background: #8B7355; border-color: var(--color-accent-warm); color: #F9F8F3;
  }
  .cart-gift-wrap__text { flex: 1; }
  .cart-gift-wrap__title {
    font-family: var(--font-body);
    font-size: 13px; font-weight: 600; color: var(--color-text); display: block;
  }
  .cart-gift-wrap__desc {
    font-family: var(--font-body);
    font-size: 11px; color: rgba(29,29,29,0.45); display: block; margin-top: 2px;
  }
  .cart-gift-wrap__badge {
    font-family: var(--font-body);
    font-size: 11px; font-weight: 600; color: var(--color-accent-warm);
    text-transform: uppercase; letter-spacing: 0.05em;
  }

  /* ===== Upsell Carousel ===== */
  .cart-page__promos {
    margin-top: 24px; padding-top: 24px;
    border-top: 1px solid rgba(29,29,29,0.06);
  }
  @media (min-width: 750px) { .cart-page__promos { margin-top: 40px; padding-top: 40px; } }
  .cart-upsell__header { text-align: left; margin-bottom: 20px; }
  .cart-upsell__header h3 {
    font-family: var(--font-heading);
    font-size: 22px; font-weight: 500; color: var(--color-text); margin-bottom: 4px;
  }
  .cart-upsell__header p { font-family: var(--font-body); font-size: 13px; color: rgba(29,29,29,0.5); }
  
  .cart-upsell__carousel {
    display: flex; gap: 16px; overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 8px;
    scrollbar-width: none;
  }
  .cart-upsell__carousel::-webkit-scrollbar { display: none; }
  
  .cart-upsell__slide {
    flex: 0 0 130px; /* Thinner on mobile */
    scroll-snap-align: start;
    display: flex; flex-direction: column;
    background: #FFFFFF;
    border: none;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05); /* Soft drop shadow */
    border-radius: 12px;
    overflow: hidden;
    transition: box-shadow 0.3s;
  }
  @media (min-width: 750px) { .cart-upsell__slide { flex: 0 0 160px; } }
  .cart-upsell__slide:hover { box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
  
  .cart-upsell__img-wrap {
    width: 100%; aspect-ratio: 1; overflow: hidden;
    background: #F9F8F3; border-radius: 12px 12px 0 0;
  }
  .cart-upsell__img-wrap img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease; }
  .cart-upsell__slide:hover .cart-upsell__img-wrap img { transform: scale(1.05); }
  
  .cart-upsell__info { padding: 12px; flex: 1; text-align: center; }
  .cart-upsell__title { 
    font-family: var(--font-body);
    font-size: 12px; font-weight: 600; line-height: 1.4; color: var(--color-text); 
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-decoration: none; 
    margin-bottom: 6px;
  }
  .cart-upsell__title:hover { color: var(--color-sale); }
  .cart-upsell__price { display: flex; align-items: baseline; gap: 6px; justify-content: center; }
  .cart-upsell__price-current { font-family: var(--font-body); font-size: 14px; font-weight: 700; color: var(--color-sale); }
  .cart-upsell__price-compare { font-family: var(--font-body); font-size: 11px; color: #B4B4B4; text-decoration: line-through; }
  
  .cart-upsell__add { 
    width: calc(100% - 20px); margin: 0 10px 10px 10px;
    background: #F4E8FA; color: #E11D48;
    border: none; border-radius: 50px;
    padding: 8px 10px; font-family: var(--font-body);
    font-size: 11px; font-weight: 700; cursor: pointer; 
    text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.3s;
  }
  .cart-upsell__add:hover { background: #EBD4F6; }

  /* ===== Order Summary ===== */
  .cart-page__summary-card {
    background: #FFFFFF;
    border-radius: 16px; padding: 20px 16px;
    position: sticky; top: 120px;
    border: 1px solid rgba(29,29,29,0.06);
  }
  @media (min-width: 750px) { .cart-page__summary-card { padding: 36px 28px; } }
  .cart-page__summary-card h3 { 
    font-family: var(--font-heading);
    font-size: 22px; font-weight: 500; 
    margin-bottom: 24px; color: var(--color-text); 
  }

  /* Order Protection */
  .cdraw-protect { 
    display: flex; align-items: flex-start; justify-content: space-between; 
    padding: 12px; background: #F9F8F3; border-radius: 12px; 
    margin-bottom: 20px; border: 1px solid rgba(29,29,29,0.06); cursor: pointer; transition: all 0.3s ease;
  }
  @media (min-width: 750px) { .cdraw-protect { padding: 16px; margin-bottom: 24px; } }
  .cdraw-protect:hover { border-color: rgba(29,29,29,0.12); }
  .cdraw-protect__title {
    font-family: var(--font-body);
    font-size: 12px; font-weight: 600; color: var(--color-text); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px;
  }
  .cdraw-protect__desc { font-family: var(--font-body); font-size: 12px; color: rgba(29,29,29,0.5); line-height: 1.4; }
  .cdraw-protect__price { font-weight: 600; color: var(--color-text); }
  .cdraw-protect__toggle {
    position: relative; width: 40px; height: 22px;
    background: rgba(29,29,29,0.1); border-radius: 20px;
    transition: background 0.3s; flex-shrink: 0; margin-top: 2px;
  }
  .cdraw-protect__toggle::after {
    content: ''; position: absolute; top: 2px; left: 2px;
    width: 18px; height: 18px; background: #FFFFFF; border-radius: 50%;
    transition: left 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  .cdraw-protect.active { border-color: #E6CDA9; background: rgba(230,205,169,0.08); }
  .cdraw-protect.active .cdraw-protect__toggle { background: #E6CDA9; }
  .cdraw-protect.active .cdraw-protect__toggle::after { left: 20px; }

  /* Summary Rows */
  .cart-page__summary-row {
    font-family: var(--font-body);
    display: flex; justify-content: space-between; margin-bottom: 16px; font-size: 14px; color: rgba(29,29,29,0.6);
  }
  .cart-page__summary-row strong { color: var(--color-text); font-weight: 500; }
  .cart-shipping-free { font-family: var(--font-body); font-weight: 600; color: var(--color-accent-warm); font-size: 14px; letter-spacing: 0.5px; }
  .cart-page__summary-divider { height: 1px; background: rgba(29,29,29,0.06); margin: 20px 0; }
  .cart-page__summary-total {
    font-family: var(--font-heading);
    font-size: 20px; font-weight: 400; color: var(--color-text); align-items: center;
  }
  .cart-page__summary-total strong {
    font-family: var(--font-heading);
    font-size: 26px; font-weight: 500; color: var(--color-text);
  }

  /* ===== Checkout Button ===== */
  .cart-page__checkout-btn {
    display: flex; width: 100%; padding: 16px 24px; margin-top: 28px;
    background: var(--color-primary); color: #FFFFFF !important;
    justify-content: center; align-items: center; gap: 12px;
    font-family: var(--font-body);
    font-weight: 600; font-size: 13px; letter-spacing: 1px; text-transform: uppercase;
    transition: all 0.3s ease; text-decoration: none;
    border: none; border-radius: 50px; position: relative; overflow: hidden;
  }
  .cart-page__checkout-btn svg { transition: transform 0.3s ease; stroke: #FFFFFF; }
  .cart-page__checkout-btn:hover { background: var(--color-primary-dark); }
  .cart-page__checkout-btn:active { transform: scale(0.96) translateY(2px); transition: transform 0.08s ease; }
  .cart-page__checkout-btn:hover svg { transform: translateX(4px); }
  
  /* Express & Trust */
  .cart-express { margin-top: 24px; text-align: center; border-top: 1px solid rgba(29,29,29,0.06); padding-top: 24px; }
  .cart-express__label {
    font-family: var(--font-body);
    display: block; font-size: 10px; text-transform: uppercase; letter-spacing: 1.5px;
    color: rgba(29,29,29,0.4); margin-bottom: 16px; font-weight: 600;
  }
  .cart-express__buttons { display: flex; gap: 10px; justify-content: center; }
  
  /* Express Checkout (Dynamic) */
  .additional-checkout-buttons { 
    display: flex; flex-direction: row; flex-wrap: nowrap; gap: 8px; width: 100%; justify-content: space-between; align-items: stretch;
    border: 1px dashed rgba(45,27,46,0.3); padding: 8px 10px; border-radius: 12px;
  }
  .additional-checkout-buttons [data-shopify-buttoncontainer] { flex: 1; min-width: 0; }
  .additional-checkout-buttons [data-shopify-buttoncontainer] ul,
  .additional-checkout-buttons ul { display: flex; flex-direction: row; flex-wrap: nowrap; gap: 6px; width: 100%; justify-content: space-between; margin: 0; padding: 0; }
  .additional-checkout-buttons [data-shopify-buttoncontainer] li,
  .additional-checkout-buttons li { flex: 1; list-style: none; min-width: 0; display: flex; }
  .additional-checkout-buttons [role="button"],
  .additional-checkout-buttons button { border-radius: 50px !important; overflow: hidden; height: 44px !important; width: 100% !important; min-width: 0 !important; max-width: none !important; padding: 0 4px !important; transition: transform 0.2s, opacity 0.2s; }
  .additional-checkout-buttons [role="button"]:hover,
  .additional-checkout-buttons button:hover { transform: translateY(-2px); opacity: 0.9; }
  .additional-checkout-buttons .dynamic-checkout__content { margin: 0; width: 100%; }

  /* Monochrome Payment Icons */
  .cdraw-payments {
    display: flex; align-items: center; justify-content: center; flex-wrap: wrap;
    gap: 8px; margin: 24px 0 20px;
  }
  .cdraw-payment-icon { width: 56px; height: 36px; border-radius: 4px; overflow: hidden; display: inline-flex; border: none; }
  .cdraw-payment-icon svg { width: 100%; height: 100%; }

  /* Monochrome Trust Badges */
  .cdraw-trust {
    display: flex; justify-content: space-between; gap: 16px;
    margin-top: 20px; border-top: 1px solid rgba(29,29,29,0.06); padding-top: 20px;
  }
  .cdraw-trust__item {
    display: flex; flex-direction: column; align-items: center; gap: 8px;
    color: rgba(29,29,29,0.4); text-align: center; flex: 1;
  }
  .cdraw-trust__item svg { width: 20px; height: 20px; color: rgba(29,29,29,0.35); stroke-width: 1.5; }
  .cdraw-trust__text {
    font-family: var(--font-body);
    font-size: 10px; font-weight: 500; line-height: 1.4; letter-spacing: 0.5px; text-transform: uppercase;
  }

  .cart-page__continue-wrap { text-align: center; margin-top: 24px; }
  .cart-page__continue {
    font-family: var(--font-body);
    display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    font-size: 12px; color: rgba(29,29,29,0.5); letter-spacing: 1px; text-transform: uppercase;
    font-weight: 500; text-decoration: none; transition: all 0.3s; border-bottom: 1px solid transparent; padding-bottom: 2px;
  }
  .cart-page__continue:hover { color: var(--color-sale); border-bottom-color: rgba(29,29,29,0.1); }
  .cart-page__continue svg { transition: transform 0.3s ease; }
  .cart-page__continue:hover svg { transform: translateX(-4px); }

  /* ===== Shipping Progress Bar ===== */
  .cart-shipping-bar {
    display: flex; flex-direction: column; gap: 8px;
    padding: 16px 20px; margin-bottom: 24px; border-radius: 12px;
    background: var(--color-bg); border: 1px solid rgba(45,27,46,0.06);
  }
  @media (min-width: 750px) { .cart-shipping-bar { gap: 12px; padding: 20px 28px; margin-bottom: 32px; } }
  .cart-shipping-bar__text {
    font-family: var(--font-body);
    display: flex; align-items: center; gap: 10px;
    font-size: 13px; color: rgba(29,29,29,0.6); letter-spacing: 0.3px;
  }
  .cart-shipping-bar__text strong { color: var(--color-text); font-weight: 600; }
  .cart-shipping-bar__track {
    width: 100%; height: 3px;
    background: rgba(29,29,29,0.06); border-radius: 2px; overflow: hidden;
  }
  .cart-shipping-bar__fill {
    height: 100%; background: var(--color-sale-tag-bg);
    transition: width 0.8s cubic-bezier(0.165, 0.84, 0.44, 1);
    border-radius: 2px;
  }
  
  .cart-shipping-bar--achieved { 
    background: #F9F8F3;
    border: 1px solid rgba(29,29,29,0.06);
    flex-direction: row; align-items: center; gap: 10px;
  }
  .cart-shipping-bar--achieved span { font-family: var(--font-body); font-size: 13px; color: rgba(29,29,29,0.6); }
  .cart-shipping-bar--achieved strong { color: var(--color-text); }

  /* Empty Cart */
  .cart-page__empty {
    text-align: center; padding: 80px 24px;
    background: transparent; border-radius: 16px;
  }
  .cart-empty-heading { font-family: var(--font-heading); font-size: 22px; margin-bottom: 8px; color: var(--color-text); }
  .cart-empty-text { font-family: var(--font-body); color: rgba(29,29,29,0.5); margin-bottom: 24px; font-size: 14px; }

  /* ===== Sticky Checkout Bar ===== */
  .cart-sticky-bar {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: rgba(253, 242, 244, 0.85);
    backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
    z-index: 100;
    border-top: 1px solid rgba(255,255,255,0.2);
    transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    padding-bottom: env(safe-area-inset-bottom);
  }
  .cart-sticky-bar.visible { transform: translateY(0); }
  .cart-sticky-bar__inner {
    max-width: var(--container-max); margin: 0 auto;
    padding: 14px 24px; display: flex; align-items: center; justify-content: space-between; gap: 24px;
  }
  .cart-sticky-bar__left { display: flex; flex-direction: column; gap: 2px; flex-shrink: 0; }
  .cart-sticky-bar__total { font-family: var(--font-body); font-size: 13px; color: rgba(29,29,29,0.7); }
  .cart-sticky-bar__total strong { font-size: 20px; color: #1D1D1D; font-weight: 700; margin-left: 4px; }
  .cart-sticky-bar__warranty {
    display: flex; align-items: center; gap: 4px;
    font-family: var(--font-body);
    color: #E11D48; font-size: 10px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.5px;
  }
  .cart-sticky-bar__secure {
    display: flex; align-items: center; gap: 6px;
    font-family: var(--font-body);
    color: #10B981; font-size: 10px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.5px;
    margin-bottom: 6px;
  }
  .cart-sticky-bar__center {
    display: flex; flex-direction: column; align-items: center; flex-shrink: 0;
  }
  .cart-sticky-bar__icons {
    display: flex; align-items: center; gap: 6px;
  }
  .cart-sticky-icon { width: 40px; height: 26px; border-radius: 4px; overflow: hidden; display: inline-flex; }
  .cart-sticky-icon svg { width: 100%; height: 100%; }
  .cart-sticky-bar__actions { flex-shrink: 0; }
  
  .cart-sticky-bar__btn {
    padding: 14px 36px; margin: 0; width: auto; font-size: 13px;
    border-radius: 50px !important; background-color: #E11D48 !important; color: #FFFFFF !important; transition: transform 0.2s;
  }
  .cart-sticky-bar__btn:hover { background-color: #BE123C !important; transform: translateY(-2px); }
  @media (max-width: 768px) {
    .cart-sticky-bar__inner { padding: 12px 16px; gap: 12px; }
    .cart-sticky-bar__btn { padding: 14px 24px; font-size: 12px; }
    .cart-sticky-bar__center { display: none; }
  }

  /* ===== Cart Warranty (Spacious) ===== */
  .cart-warranty {
    margin-top: 48px;
    background: var(--color-bg-warm);
    border-radius: 16px;
    padding: 32px 28px;
    text-align: center;
  }
  .cart-warranty__strip {
    display: flex; gap: 10px; margin-bottom: 24px;
    overflow-x: auto; scroll-snap-type: x mandatory; padding-bottom: 8px;
    scrollbar-width: none;
  }
  .cart-warranty__strip::-webkit-scrollbar { display: none; }
  .cart-warranty__img {
    flex: 0 0 85%; scroll-snap-align: center; aspect-ratio: 4/3; border-radius: 10px; overflow: hidden;
  }
  @media (min-width: 750px) {
    .cart-warranty__strip { overflow-x: visible; }
    .cart-warranty__img { flex: 1; }
  }
  .cart-warranty__img img {
    width: 100%; height: 100%; object-fit: cover;
    transition: transform 0.5s ease;
  }
  .cart-warranty__img:hover img { transform: scale(1.05); }
  .cart-warranty__body { max-width: 520px; margin: 0 auto; }
  .cart-warranty__label {
    font-family: var(--font-body);
    font-size: 10px; font-weight: 700; letter-spacing: 0.2em;
    color: var(--color-accent-warm); text-transform: uppercase;
    display: block; margin-bottom: 10px;
  }
  .cart-warranty__heading {
    font-family: var(--font-heading);
    font-size: 24px; font-weight: 600; color: var(--color-text);
    line-height: 1.2; margin-bottom: 12px;
  }
  .cart-warranty__text {
    font-family: var(--font-body);
    font-size: 13px; line-height: 1.8; color: rgba(29,29,29,0.55);
    margin-bottom: 20px;
  }
  .cart-warranty__features {
    display: flex; justify-content: center; flex-wrap: wrap; gap: 24px;
  }
  .cart-warranty__feature {
    display: flex; align-items: center; gap: 8px;
    font-family: var(--font-body);
    font-size: 12px; font-weight: 600; color: var(--color-text);
  }
  .cart-warranty__feature svg {
    color: var(--color-accent-warm); flex-shrink: 0;
  }
</style>

<div class="cart-remove-popup" id="cart-remove-popup">
  <div class="cart-remove-popup__overlay" onclick="closeRemovePopup()"></div>
  <div class="cart-remove-popup__modal">
    <button class="cart-remove-popup__close" onclick="closeRemovePopup()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
    <img id="popup-product-img" src="" alt="Product" class="cart-remove-popup__img">
    <h3 class="cart-remove-popup__title">Are you sure?</h3>
    <p class="cart-remove-popup__text">This piece was chosen with love üíï<br>Would you like to keep it in your cart?</p>
    <p id="popup-product-name" class="cart-remove-popup__product-name"></p>
    <div class="cart-remove-popup__actions">
      <button class="cart-remove-popup__keep" onclick="closeRemovePopup()">Keep This Item</button>
      <button class="cart-remove-popup__remove" id="popup-confirm-remove">Remove Item</button>
    </div>
  </div>
</div>

<style>
  .cart-remove-popup { display:none; position:fixed; top:0; left:0; right:0; bottom:0; z-index:9999; align-items:center; justify-content:center; }
  .cart-remove-popup.active { display:flex; }
  .cart-remove-popup__overlay { position:absolute; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.4); backdrop-filter:blur(4px); }
  .cart-remove-popup__modal {
    position:relative; background:#F9F8F3; border-radius:16px; padding:36px 28px; max-width:400px; width:90%;
    text-align:center; box-shadow:0 20px 60px rgba(0,0,0,0.15); animation: popupSlideIn 0.3s ease;
    border: 1px solid rgba(29,29,29,0.06);
  }
  @keyframes popupSlideIn { from { opacity:0; transform:scale(0.95) translateY(20px); } to { opacity:1; transform:scale(1) translateY(0); } }
  .cart-remove-popup__close {
    position:absolute; top:12px; right:16px; background:none; border:none;
    color:rgba(29,29,29,0.4); cursor:pointer; line-height:1; padding: 4px;
    transition: color 0.2s;
  }
  .cart-remove-popup__close:hover { color:#7F1B17; }
  .cart-remove-popup__img { width:100px; height:100px; border-radius:12px; object-fit:cover; margin:0 auto 16px; display:block; border:1px solid rgba(29,29,29,0.06); }
  .cart-remove-popup__title { font-family:var(--font-heading); font-size:22px; font-weight:500; margin-bottom:8px; color:#1D1D1D; }
  .cart-remove-popup__text { font-family:var(--font-body); font-size:13px; color:rgba(29,29,29,0.5); line-height:1.5; margin-bottom:12px; }
  .cart-remove-popup__product-name { font-family:var(--font-body); font-size:12px; font-weight:600; color:#8B7355; margin-bottom:24px; }
  .cart-remove-popup__actions { display:flex; flex-direction:column; gap:12px; }
  .cart-remove-popup__keep {
    padding:14px 24px; border-radius:50px; border:none;
    background:var(--color-primary); color:#FFFFFF; font-family:var(--font-body);
    font-size:12px; font-weight:600; text-transform:uppercase; letter-spacing:1px;
    cursor:pointer; transition:all 0.2s;
  }
  .cart-remove-popup__keep:hover { background:var(--color-primary-dark); }
  .cart-remove-popup__remove {
    padding:12px 24px; border-radius:50px; border:1.5px solid rgba(29,29,29,0.1);
    background:transparent; color:rgba(29,29,29,0.4); font-family:var(--font-body);
    font-size:11px; font-weight:600; text-transform:uppercase; letter-spacing:1px;
    cursor:pointer; transition:all 0.2s;
  }
  .cart-remove-popup__remove:hover { border-color:var(--color-primary); color:var(--color-primary); background:rgba(225,29,72,0.04); }
</style>

<script>
  // Love note character counter
  const loveNote = document.getElementById('cart-love-note');
  const loveCount = document.getElementById('love-note-count');
  if (loveNote && loveCount) {
    loveNote.addEventListener('input', function() {
      loveCount.textContent = this.value.length;
    });
  }

  // Remove confirmation popup
  let pendingRemoveUrl = '';
  
  function showRemovePopup(removeUrl, productName, productImg) {
    pendingRemoveUrl = removeUrl;
    document.getElementById('popup-product-name').textContent = productName;
    document.getElementById('popup-product-img').src = productImg;
    document.getElementById('cart-remove-popup').classList.add('active');
    document.body.style.overflow = 'hidden';
  }
  
  function closeRemovePopup() {
    document.getElementById('cart-remove-popup').classList.remove('active');
    document.body.style.overflow = '';
    pendingRemoveUrl = '';
  }
  
  document.getElementById('popup-confirm-remove').addEventListener('click', function() {
    if (pendingRemoveUrl) {
      window.location.href = pendingRemoveUrl;
    }
  });

  // Attach remove buttons via event delegation
  document.addEventListener('click', function(e) {
    var removeBtn = e.target.closest('.cart-page__remove[data-remove-url]');
    if (removeBtn) {
      e.preventDefault();
      showRemovePopup(
        removeBtn.getAttribute('data-remove-url'),
        removeBtn.getAttribute('data-remove-title'),
        removeBtn.getAttribute('data-remove-img')
      );
    }
  });

  // Sticky checkout bar Logic (Fade out when main checkout btn is visible)
  document.addEventListener('DOMContentLoaded', function() {
    const stickyBar = document.getElementById('cart-sticky-bar');
    const mainCheckoutBtn = document.querySelector('.cart-page__checkout-container .cart-page__checkout-btn');
    
    if (stickyBar) {
      // Always visible by default unless intersecting
      stickyBar.classList.add('visible');
      
      if (mainCheckoutBtn && 'IntersectionObserver' in window) {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              stickyBar.classList.remove('visible'); // Hide when main btn is in view
            } else {
              stickyBar.classList.add('visible'); // Show otherwise
            }
          });
        }, { rootMargin: '0px 0px 0px 0px', threshold: 0 });
        
        observer.observe(mainCheckoutBtn);
      }
    }
  });

  // Dynamic Order Protection Total Formatting
  function formatMoneyStr(cents) {
    return '$' + (cents / 100).toFixed(2);
  }

  function updateCartTotals() {
    const isProtected = document.getElementById('order-protection-checkbox').checked;
    const protectAttr = document.getElementById('order-protection-attribute');
    const subtotalEl = document.getElementById('cart-subtotal');
    const totalEl = document.getElementById('cart-final-total');
    
    // Enable/Disable the cart attribute for checkout
    if (protectAttr) protectAttr.disabled = !isProtected;
    
    if (subtotalEl && totalEl) {
      const baseTotal = parseInt(subtotalEl.getAttribute('data-base-total'), 10) || 0;
      const protectFee = isProtected ? 420 : 0; // $4.20 in cents
      const newTotal = baseTotal + protectFee;
      
      subtotalEl.textContent = formatMoneyStr(newTotal);
      totalEl.textContent = formatMoneyStr(newTotal);

      // Also update sticky total if available
      const stickyTotal = document.querySelector('.cart-sticky-bar__btn strong');
      if (stickyTotal) {
         stickyTotal.innerHTML = `Total &bullet; ${formatMoneyStr(newTotal)}`;
      }
    }
  }
</script>

{% schema %}
{
  "name": "Cart",
  "settings": []
}
{% endschema %}
