<section class="main-product">
  <div class="pdp-grain-overlay"></div>
  <div class="product-container">
    <!-- Breadcrumbs -->
    <nav class="product-breadcrumbs">
      <a href="/">Home</a>
      <span>â€º</span>
      {%- if product.collections.size > 0 -%}
        <a href="{{ product.collections.first.url }}">{{ product.collections.first.title }}</a>
        <span>â€º</span>
      {%- endif -%}
      <span>{{ product.title | truncate: 50 }}</span>
    </nav>

    <!-- Two-column Product Hero -->
    <div class="product-hero">
      <!-- LEFT: Image Gallery (wider) -->
      <div class="product-gallery">
        <div class="product-gallery__thumbs">
          {%- for image in product.images -%}
            <div class="product-gallery__thumb {% if forloop.first %}active{% endif %}" data-index="{{ forloop.index0 }}" data-full="{{ image | image_url: width: 900 }}">
              <img src="{{ image | image_url: width: 150 }}" alt="{{ image.alt | default: product.title }}" loading="lazy">
            </div>
          {%- endfor -%}
        </div>
        <div class="product-gallery__main">
          <div class="product-gallery__zoom-container">
            {%- if product.featured_image != blank -%}
              <img id="product-main-image" src="{{ product.featured_image | image_url: width: 900 }}" alt="{{ product.title }}">
            {%- else -%}
              {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
            {%- endif -%}
          </div>
        </div>
      </div>

      <!-- RIGHT: Product Info (narrower, sticky) -->
      <div class="product-info" id="product-info-col">
        <div class="product-info__scroll" id="product-scroll-area">
          <div class="product-info__body">
          <!-- Social proof bar -->
          <div class="product-social-proof">
            <span class="proof-avatars">
              <span class="proof-avatar" style="background:#e8a87c;">S</span>
              <span class="proof-avatar" style="background:#d4a5a5;">M</span>
            </span>
            <span class="proof-text"><strong>sarah.m</strong> âœ“ , <strong>mike.t</strong> âœ“ and <strong class="proof-highlight">8,247</strong> others carry our products.</span>
          </div>

          <!-- Title -->
          <h1 class="product-title">{{ product.title }}</h1>

          <!-- Rating -->
          <div class="product-rating">
            <span class="rating-stars">â˜…â˜…â˜…â˜…â˜…</span>
            <span class="rating-score">4.9</span>
            <span class="rating-count">(778)</span>
          </div>

          <!-- Price -->
          <div class="product-price">
            <span class="price-current">{{ product.price | money }}</span>
            {%- if product.compare_at_price > product.price -%}
              <span class="price-compare">{{ product.compare_at_price | money }}</span>
            {%- else -%}
              {%- assign hash_val = product.id | modulo: 100 -%}
              {%- assign multiplier = 200 | plus: hash_val -%}
              {%- assign fake_compare_price = product.price | times: multiplier | divided_by: 100 -%}
              <span class="price-compare">{{ fake_compare_price | money }}</span>
            {%- endif -%}
          </div>

          {%- if product.compare_at_price > product.price -%}
            {%- assign savings = product.compare_at_price | minus: product.price -%}
          {%- else -%}
            {%- assign hash_val = product.id | modulo: 100 -%}
            {%- assign multiplier = 200 | plus: hash_val -%}
            {%- assign fake_compare_price = product.price | times: multiplier | divided_by: 100 -%}
            {%- assign savings = fake_compare_price | minus: product.price -%}
          {%- endif -%}
          <div class="product-curated-tag">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M6 3h12l4 6-10 13L2 9Z"/><path d="M11 3 8 9l4 13 4-13-3-6"/><path d="M2 9h20"/></svg>
            A Curated Gift
          </div>

          <!-- Short Description -->
          <div class="product-short-desc">
            <p>Finding a gift that says "I love you" shouldn't feel ordinary. Give her an unforgettable unboxing experience that transcends words and speaks directly to the soul.</p>
          </div>

          <!-- Feature highlights -->
          <div class="product-features">
            <div class="product-feature">
              <span class="feature-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--color-accent-warm)" stroke-width="1.5"><rect x="3" y="10" width="18" height="12" rx="2"/><path d="M12 10V22"/><path d="M3 16h18"/><path d="M7.5 10C7.5 10 7.5 4 12 4s4.5 6 4.5 6"/><path d="M8 2l4 2 4-2"/></svg></span>
              <div><strong>A Sacred Keepsake:</strong> A beautifully crafted presentation designed to elevate your gifting from a simple transaction into a deeply emotional ritual.</div>
            </div>
            <div class="product-feature">
              <span class="feature-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--color-accent-warm)" stroke-width="1.5"><path d="M18.178 8c5.096 0 5.096 8 0 8-5.095 0-7.133-8-12.739-8-4.585 0-4.585 8 0 8 5.606 0 7.644-8 12.74-8z"/></svg></span>
              <div><strong>The Eternal Bond:</strong> Meticulously handcrafted details that never fade, serving as a constant, physical reminder of an enduring love that stands the test of time.</div>
            </div>
            <div class="product-feature">
              <span class="feature-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--color-accent-warm)" stroke-width="1.5"><path d="M12 2l2.09 6.26L20.18 9l-5 4.09L16.82 20 12 16.54 7.18 20l1.64-6.91L3.82 9l6.09-.74z"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="2" x2="12" y2="5"/><line x1="12" y1="19" x2="12" y2="22"/><line x1="2" y1="12" x2="5" y2="12"/><line x1="19" y1="12" x2="22" y2="12"/></svg></span>
              <div><strong>Ready to Melt Her Heart:</strong> Arrives impeccably packaged and ready to be presented, removing the stress of gifting so you can focus entirely on the moment.</div>
            </div>
          </div>

          <!-- Variant selector -->
          {%- if product.has_only_default_variant == false -%}
            <div class="product-variants" id="product-variants">
              {%- for option in product.options_with_values -%}
                <div class="variant-group" data-option-index="{{ forloop.index0 }}">
                  <p class="variant-label">{{ option.name }}: <strong class="variant-selected-value" style="color:var(--color-primary);">{{ option.selected_value }}</strong></p>
                  <div class="variant-options-row">
                    {%- for value in option.values -%}
                      <button type="button" class="variant-pill {% if value == option.selected_value %}active{% endif %}" data-option-value="{{ value }}">
                        {{ value }}
                      </button>
                    {%- endfor -%}
                  </div>
                </div>
              {%- endfor -%}
            </div>
          {%- endif -%}

          <!-- Shipping timer -->
          <div class="product-shipping-card">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            <span>Order in the next <strong id="shipping-timer">2h 15m</strong> for delivery by <strong id="shipping-date"></strong></span>
          </div>

          <!-- Free shipping countdown -->
          <div class="product-countdown">
            <div class="countdown-icon">ðŸšš</div>
            <div class="countdown-text">
              <strong>FREE SHIPPING</strong> ends in:
              <span class="countdown-timer" id="free-ship-timer">
                <span class="countdown-unit"><span id="cd-hours">23</span>h</span>
                <span class="countdown-unit"><span id="cd-mins">59</span>m</span>
                <span class="countdown-unit"><span id="cd-secs">59</span>s</span>
              </span>
            </div>
          </div>

          <!-- Trust badges -->
          <div class="product-trust">
            <div class="trust-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2"><path d="M5 12h14"/><path d="M12 5l7 7-7 7"/></svg>
              <span>Free US Shipping</span>
            </div>
            <div class="trust-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
              <span>Lifetime Warranty</span>
            </div>
            <div class="trust-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>
              <span>30-Day Returns</span>
            </div>
            <div class="trust-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
              <span>Secure Checkout</span>
            </div>
          </div>

          <!-- Accordions -->
          <div class="product-accordions">
            {%- assign has_accordions = false -%}
            {%- for block in section.blocks -%}
              {%- if block.type == 'accordion' -%}
                {%- assign has_accordions = true -%}
                <details class="product-accordion" {% if forloop.first %}open{% endif %} {{ block.shopify_attributes }}>
                  <summary>{{ block.settings.heading }}</summary>
                  <div class="accordion-content">
                    {{ block.settings.content }}
                  </div>
                </details>
              {%- endif -%}
            {%- endfor -%}

            {%- if has_accordions == false -%}
              <details class="product-accordion">
                <summary>The Artisan's Journey</summary>
                <div class="accordion-content">
                  <p>Every piece begins with a profound respect for the emotion it will carry.</p>
                  <p>Our artisans hand-select each preserved rose at its absolute peakâ€”capturing its velvety texture and vibrant color forever.</p>
                  <p>The jewelry is forged from ethically sourced metals and brilliant stones, because a love built to last should never harm the earth.</p>
                  <p>From the final hand-polish to the precise assembly of our display vaultsâ€”every step is a labor of love, crafted to honor yours.</p>
                </div>
              </details>
              <details class="product-accordion">
                <summary>Materials &amp; Care</summary>
                <div class="accordion-content">
                  <p><strong>The Jewelry</strong></p>
                  <p>925 Sterling Silver Â· Stainless Steel Â· Hypoallergenic Copper<br>Finished in luxurious 14K Gold or Rhodium. Skin-safe by design.</p>
                  <p><em>Care:</em> Gently wipe with a soft microfiber cloth to maintain brilliance.</p>
                  <p><strong>The Eternal Blooms</strong></p>
                  <p>Zero maintenance. No water, no sunlight needed.</p>
                  <p>Keep them in their sanctuary box, away from harsh sunlight or extreme humidityâ€”they'll retain their beauty for years.</p>
                </div>
              </details>
              <details class="product-accordion">
                <summary>How It Works</summary>
                <div class="accordion-content">
                  <p>Gifting should be a cinematic experienceâ€”not just a transaction.</p>
                  <p>Your keepsake arrives impeccably packaged and completely ready to present.</p>
                  <p>Depending on your collection, the unboxing unfolds as a ritual: a smooth drawer gliding open, a dramatic double-door reveal, or a gentle rotation presenting the hidden jewelry beneath the bloom.</p>
                  <p>Write your truth on the included message card, present the box, and prepare for an unforgettable moment.</p>
                </div>
              </details>
              <details class="product-accordion">
                <summary>Are The Pieces Waterproof?</summary>
                <div class="accordion-content">
                  <p>Our jewelry is highly durable and designed to anchor your everyday life.</p>
                  <p>While an occasional splash of water won't break the bond, we highly recommend removing your pieces before showering, swimming, or intense workouts.</p>
                  <p>Protecting them from prolonged exposure to moisture, perfumes, and lotions ensures the metallic finish and sparkling stones remain exactly as radiant as the day you gifted them.</p>
                </div>
              </details>
              <details class="product-accordion">
                <summary>Need Help Choosing The Right Size?</summary>
                <div class="accordion-content">
                  <p>Take the guesswork out of gifting. We've designed our collections to be effortlessly universal.</p>
                  <p>Almost all of our necklaces feature a versatile "clavicle chain" design (typically 18 inches / 45cm) paired with a built-in 2-inch (5cm) extension loop. This allows the pendant to rest perfectly at her collarbone or be adjusted slightly lower, ensuring a flawless and comfortable fit for any silhouette.</p>
                </div>
              </details>
              <details class="product-accordion">
                <summary>Shipping Info</summary>
                <div class="accordion-content">
                  <p><strong>Processing</strong></p>
                  <p>Your gift ships within 6 hours of ordering (excl. weekends & holidays), handled with the utmost care.</p>
                  <p><strong>Delivery Estimates</strong></p>
                  <ul>
                    <li>United States â€” 5â€“12 Business Days</li>
                    <li>UK &amp; EU â€” 5â€“12 Business Days</li>
                    <li>Australia &amp; NZ â€” 5â€“12 Business Days</li>
                    <li>Rest of World â€” 5â€“12 Business Days (est.)</li>
                  </ul>
                  <p>Exact shipping charges are calculated at checkout. We ship worldwide.</p>
                  <p><strong>Our Promise</strong></p>
                  <p>During peak gifting seasons, slight delays may occur. If there's any significant delay, our support team will contact you directly. Your peace of mind is our priority.</p>
                </div>
              </details>
            {%- endif -%}
          </div>

          <!-- Upsell Section -->
          <div class="product-upsell">
            <div class="upsell-header">
              <div class="upsell-title">ðŸ”¥ <span>Special Offers!</span></div>
              <div class="upsell-badge">SAVE UP TO 15%</div>
            </div>
            <div class="upsell-tags">
              <span class="upsell-tag" id="upsell-tag-1">+1 item &rarr; 5% OFF</span>
              <span class="upsell-tag" id="upsell-tag-2">+2 items &rarr; 15% OFF</span>
            </div>
            <div class="upsell-items">
              {%- assign has_upsells = false -%}
              {%- for block in section.blocks -%}
                {%- if block.type == 'upsell' and block.settings.product != blank -%}
                  {%- assign has_upsells = true -%}
                  {%- assign upsell_product = block.settings.product -%}
                  <label class="upsell-item" {{ block.shopify_attributes }}>
                    <input type="checkbox" class="upsell-checkbox" data-variant-id="{{ upsell_product.selected_or_first_available_variant.id }}" data-price="{{ upsell_product.price }}">
                    <span class="custom-checkbox"></span>
                    <img src="{{ upsell_product.featured_image | image_url: width: 150 }}" alt="{{ upsell_product.title | escape }}" class="upsell-img">
                    <div class="upsell-info">
                      <span class="upsell-name">{{ upsell_product.title }}</span>
                      {%- assign h_size = upsell_product.handle | size -%}
                      {%- assign id_shift = upsell_product.id | divided_by: 7 -%}
                      {%- assign upsell_rating_mod = id_shift | plus: h_size | modulo: 4 -%}
                      {%- if upsell_rating_mod == 0 -%}{%- assign u_rating = "5.0" -%}{%- assign u_stars = "â˜…â˜…â˜…â˜…â˜…" -%}
                      {%- elsif upsell_rating_mod == 1 -%}{%- assign u_rating = "4.9" -%}{%- assign u_stars = "â˜…â˜…â˜…â˜…â˜…" -%}
                      {%- elsif upsell_rating_mod == 2 -%}{%- assign u_rating = "4.8" -%}{%- assign u_stars = "â˜…â˜…â˜…â˜…â˜†" -%}
                      {%- else -%}{%- assign u_rating = "4.7" -%}{%- assign u_stars = "â˜…â˜…â˜…â˜…â˜†" -%}
                      {%- endif -%}
                      {%- assign u_count = upsell_product.id | modulo: 874 | plus: 128 -%}
                      <div class="upsell-rating"><span class="u-stars">{{ u_stars }}</span> <span class="u-count">{{ u_rating }} ({{ u_count }})</span></div>
                      <div class="upsell-price-row">
                        <span class="upsell-price">{{ upsell_product.price | money }}</span>
                        {%- if upsell_product.compare_at_price > upsell_product.price -%}
                          <span class="upsell-compare">{{ upsell_product.compare_at_price | money }}</span>
                        {%- else -%}
                          {%- assign u_hash = upsell_product.id | modulo: 100 -%}
                          {%- assign u_mult = 200 | plus: u_hash -%}
                          <span class="upsell-compare">{{ upsell_product.price | times: u_mult | divided_by: 100 | money }}</span>
                        {%- endif -%}
                      </div>
                    </div>
                  </label>
                {%- endif -%}
              {%- endfor -%}

              {%- if has_upsells == false -%}
                {%- comment -%} Fallback: Show other products from the same collection {%- endcomment -%}
                {%- assign fallback_products = product.collections.first.products | default: collections.all.products -%}
                {%- assign fallback_count = 0 -%}
                {%- for fp in fallback_products limit: 4 -%}
                  {%- if fp.id != product.id and fallback_count < 3 -%}
                    {%- assign fallback_count = fallback_count | plus: 1 -%}
                    <label class="upsell-item">
                      <input type="checkbox" class="upsell-checkbox" data-variant-id="{{ fp.selected_or_first_available_variant.id }}" data-price="{{ fp.price }}">
                      <span class="custom-checkbox"></span>
                      {%- if fp.featured_image != blank -%}
                        <img src="{{ fp.featured_image | image_url: width: 150 }}" alt="{{ fp.title | escape }}" class="upsell-img">
                      {%- else -%}
                        <div class="upsell-img" style="display:flex;align-items:center;justify-content:center;background:var(--color-bg-warm);font-size:24px;">ðŸ’Ž</div>
                      {%- endif -%}
                      <div class="upsell-info">
                        <span class="upsell-name">{{ fp.title | truncate: 60 }}</span>
                        {%- assign h_size = fp.handle | size -%}
                        {%- assign id_shift = fp.id | divided_by: 7 -%}
                        {%- assign upsell_rating_mod = id_shift | plus: h_size | modulo: 4 -%}
                        {%- if upsell_rating_mod == 0 -%}{%- assign u_rating = "5.0" -%}{%- assign u_stars = "â˜…â˜…â˜…â˜…â˜…" -%}
                        {%- elsif upsell_rating_mod == 1 -%}{%- assign u_rating = "4.9" -%}{%- assign u_stars = "â˜…â˜…â˜…â˜…â˜…" -%}
                        {%- elsif upsell_rating_mod == 2 -%}{%- assign u_rating = "4.8" -%}{%- assign u_stars = "â˜…â˜…â˜…â˜…â˜†" -%}
                        {%- else -%}{%- assign u_rating = "4.7" -%}{%- assign u_stars = "â˜…â˜…â˜…â˜…â˜†" -%}
                        {%- endif -%}
                        {%- assign u_count = fp.id | modulo: 874 | plus: 128 -%}
                        <div class="upsell-rating"><span class="u-stars">{{ u_stars }}</span> <span class="u-count">{{ u_rating }} ({{ u_count }})</span></div>
                        <div class="upsell-price-row">
                          <span class="upsell-price">{{ fp.price | money }}</span>
                          {%- if fp.compare_at_price > fp.price -%}
                            <span class="upsell-compare">{{ fp.compare_at_price | money }}</span>
                          {%- else -%}
                            {%- assign f_hash = fp.id | modulo: 100 -%}
                            {%- assign f_mult = 200 | plus: f_hash -%}
                            <span class="upsell-compare">{{ fp.price | times: f_mult | divided_by: 100 | money }}</span>
                          {%- endif -%}
                        </div>
                      </div>
                    </label>
                  {%- endif -%}
                {%- endfor -%}
              {%- endif -%}
            </div>

            <div class="upsell-bundle-container" id="upsell-bundle-container" style="display: none;">
              <div class="bundle-summary">
                <div class="bundle-text">Bundle total (<span id="bundle-qty-count">2</span> items)</div>
                <div class="bundle-price-wrap">
                  <span class="bundle-price-final" id="bundle-price-final">$155.43</span>
                  <span class="bundle-price-original" id="bundle-price-original">$163.61</span>
                </div>
              </div>
              <p class="bundle-savings-text">ðŸŽ‰ You save <span id="bundle-savings-percent">5</span>%: <span id="bundle-savings-amount">$8.18</span></p>
              
              <div class="product-warranty-notice" style="margin-top: 20px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                LIFETIME WARRANTY INCLUDED
              </div>
              
              <button type="button" class="bundle-add-btn" id="bundle-add-btn" onclick="document.querySelector('.product-form__submit').click();">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="8" width="18" height="14" rx="2"/><path d="M8 8V6a4 4 0 0 1 8 0v2"/></svg>
                ADD BUNDLE TO BAG â€” <span id="bundle-btn-price">$155.43</span>
              </button>
            </div>
          </div>
          </div><!-- /.product-info__body -->

          <!-- Product Purchase Area (pinned footer) -->
          <div class="product-purchase" id="product-purchase-area">
            <div id="copy-success-msg" style="display: none; color: var(--color-success); font-size: 12px; text-align: center; margin-bottom: 4px;">
              Link secured! ðŸ’…
            </div>

            <!-- WARRANTY (centered) -->
            <div class="purchase-trust-center">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
              LIFETIME WARRANTY
            </div>

            <!-- Payment logos (centered) -->
            <div class="purchase-payments-center">
              <span class="secure-checkout-text">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                100% SECURE CHECKOUT
              </span>
              <span class="cdraw-payment-icon" title="Visa"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#1A1F71"/><text x="24" y="20" text-anchor="middle" fill="#FFFFFF" font-size="11" font-weight="700" font-family="Arial">VISA</text></svg></span>
              <span class="cdraw-payment-icon" title="Mastercard"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#252525"/><circle cx="19" cy="16" r="9" fill="#EB001B"/><circle cx="29" cy="16" r="9" fill="#F79E1B"/><path d="M24 9.5a9 9 0 0 1 0 13" fill="#FF5F00"/></svg></span>
              <span class="cdraw-payment-icon" title="American Express"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#006FCF"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="7" font-weight="700" font-family="Arial">AMEX</text></svg></span>
              <span class="cdraw-payment-icon" title="Discover"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#FF6600"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="7" font-weight="700" font-family="Arial">DISCOVER</text></svg></span>
              <span class="cdraw-payment-icon" title="Apple Pay"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#000000"/><text x="24" y="19" text-anchor="middle" fill="#FFFFFF" font-size="8" font-weight="500" font-family="Arial"> Pay</text></svg></span>
              <span class="cdraw-payment-icon" title="PayPal"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#003087"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="8" font-weight="700" font-family="Arial">PayPal</text></svg></span>
              <span class="cdraw-payment-icon" title="Shop Pay"><svg viewBox="0 0 48 32" width="32" height="21"><rect width="48" height="32" rx="4" fill="#5A31F4"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="7" font-weight="600" font-family="Arial">Shop Pay</text></svg></span>
            </div>

            <!-- Qty + Add to Bag -->
            <div class="purchase-action-row">
              <div class="purchase-qty-wrapper">
                <div class="purchase-qty">
                  <button type="button" class="qty-btn" onclick="changeProductQty(-1)">âˆ’</button>
                  <input type="number" id="product-qty-input" value="1" min="1" max="10">
                  <button type="button" class="qty-btn" onclick="changeProductQty(1)">+</button>
                </div>
              </div>

              {%- form 'product', product, class: 'purchase-form' -%}
                <input type="hidden" name="id" id="product-variant-id" value="{{ product.selected_or_first_available_variant.id }}">
                <input type="hidden" name="quantity" id="product-qty-hidden" value="1">
                <button type="submit" class="purchase-submit-btn" {% unless product.available %}disabled{% endunless %}>
                  {%- if product.available -%}
                    Secure This Bond â€” {{ product.price | money }}
                  {%- else -%}
                    SOLD OUT
                  {%- endif -%}
                </button>
              {%- endform -%}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Emotional Story Section â€” pulled from product description -->
  <div class="product-story">
    <div class="product-story__inner">
      <div class="story-emotional">
        {{ product.description }}
      </div>
    </div>
  </div>
</section>

<div class="product-sticky-bar" id="product-sticky-bar">
  <div class="sticky-bar__inner">
    <div class="sticky-bar__content">
      <div class="sticky-bar__main-row">
        <!-- Left: Product Info -->
        <div class="sticky-bar__info">
          {%- if product.featured_image != blank -%}
            <img src="{{ product.featured_image | image_url: width: 100 }}" alt="{{ product.title | escape }}" class="sticky-bar__img">
          {%- endif -%}
          <div class="sticky-bar__text">
            <p class="sticky-bar__title">{{ product.title | truncate: 40 }}</p>
            <div class="sticky-bar__price-row">
              {%- assign current_price = product.price | default: 9468 -%}
              {%- if product.compare_at_price > product.price -%}
                {%- assign compare_price = product.compare_at_price -%}
              {%- else -%}
                {%- assign hash_val = product.id | modulo: 100 -%}
                {%- assign multiplier = 200 | plus: hash_val -%}
                {%- assign fake_compare_price = product.price | times: multiplier | divided_by: 100 -%}
                {%- assign compare_price = fake_compare_price | default: 18936 -%}
              {%- endif -%}
              {%- assign savings = compare_price | minus: current_price -%}
              <span class="sticky-bar__price">{{ current_price | money }}</span>
              <span class="sticky-bar__compare">{{ compare_price | money }}</span>
            </div>
          </div>
        </div>

        <!-- Warranty badge (standalone) -->
        <div class="sticky-warranty">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          LIFETIME WARRANTY
        </div>

        <!-- Center: Secure checkout + Payment logos -->
        <div class="sticky-bar__center">
          <div class="sticky-bar__secure-text">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
            100% SECURE CHECKOUT
          </div>
          <div class="sticky-bar__payment-icons">
            <span class="cdraw-payment-icon" title="Visa"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#1A1F71"/><text x="24" y="20" text-anchor="middle" fill="#FFFFFF" font-size="11" font-weight="700" font-family="Arial">VISA</text></svg></span>
            <span class="cdraw-payment-icon" title="Mastercard"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#252525"/><circle cx="19" cy="16" r="9" fill="#EB001B"/><circle cx="29" cy="16" r="9" fill="#F79E1B"/><path d="M24 9.5a9 9 0 0 1 0 13" fill="#FF5F00"/></svg></span>
            <span class="cdraw-payment-icon" title="Amex"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#006FCF"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="7" font-weight="700" font-family="Arial">AMEX</text></svg></span>
            <span class="cdraw-payment-icon" title="Apple Pay"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#000"/><text x="24" y="19" text-anchor="middle" fill="#fff" font-size="8" font-weight="500" font-family="Arial"> Pay</text></svg></span>
            <span class="cdraw-payment-icon" title="PayPal"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#003087"/><text x="24" y="18" text-anchor="middle" fill="#fff" font-size="8" font-weight="700" font-family="Arial">PayPal</text></svg></span>
          </div>
        </div>

        <!-- Right: Actions -->
        <div class="sticky-bar__actions">
          <div class="sticky-bar__qty">
            <button class="qty-btn" onclick="changeStickyQty(-1)">âˆ’</button>
            <input type="number" id="sticky-qty" value="1" min="1" max="10">
            <button class="qty-btn" onclick="changeStickyQty(1)">+</button>
          </div>
          <button class="sticky-bar__buy" onclick="document.querySelector('.purchase-submit-btn').click();">
            <span class="sticky-buy__icon">â™¡</span>
            <span class="sticky-buy__label">ADD TO BAG</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>


<style>
  /* Typography â€” uses design system variables from base.css */

  /* ===== QUIET LUXURY BACKGROUND ===== */
  .main-product {
    background: #F9F8F3 !important;
    position: relative;
  }
  .pdp-grain-overlay {
    position: absolute;
    inset: 0;
    opacity: 0.03;
    mix-blend-mode: multiply;
    pointer-events: none;
    z-index: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    background-repeat: repeat;
    background-size: 256px 256px;
  }
  .main-product .product-container,
  .main-product .product-story { position: relative; z-index: 1; }

  /* ===== PRODUCT CONTAINER ===== */
  .product-container { max-width: 1400px; margin: 0 auto; padding: 0 24px; }
  .product-breadcrumbs { padding: 14px 0; font-size: 13px; color: var(--color-text-muted); font-family: var(--font-body); }
  .product-breadcrumbs a { color: var(--color-text-muted); text-decoration: none; }
  .product-breadcrumbs a:hover { color: var(--color-sale); }

  /* ===== HERO: 65/35 split ===== */
  .product-hero { display: grid; grid-template-columns: 1fr; gap: 32px; padding-bottom: 60px; }
  @media (min-width: 900px) {
    .product-hero { grid-template-columns: 1.8fr 1fr; gap: 28px; align-items: start; }
  }

  /* ===== GALLERY ===== */
  .product-gallery { position: relative; display: flex; gap: 12px; overflow: hidden; border-radius: 16px; }
  .product-gallery__main { margin-left: 84px; width: 100%; height: 100%; }
  .product-gallery__thumbs {
    display: flex; flex-direction: column; gap: 8px;
    flex-shrink: 0; width: 72px;
    position: absolute; top: 0; bottom: 0; left: 0;
    overflow-y: auto; overflow-x: hidden;
    padding-right: 4px; /* Space for scrollbar */
  }
  .product-gallery__thumbs::-webkit-scrollbar { width: 4px; }
  .product-gallery__thumbs::-webkit-scrollbar-track { background: transparent; }
  .product-gallery__thumbs::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.15); border-radius: 4px; }
  .product-gallery__thumb {
    border: 2px solid transparent; border-radius: 10px;
    overflow: hidden; cursor: pointer; transition: border-color 0.2s;
    aspect-ratio: 1 / 1; /* SQUARE thumbnails */
    flex-shrink: 0;
  }
  .product-gallery__thumb.active { border-color: var(--color-primary); }
  .product-gallery__thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
  .product-gallery__main {
    flex: 1; border-radius: 16px; overflow: hidden;
    background: var(--color-bg-warm); position: relative;
    /* Center the image if it doesn't fill the box */
    display: flex; align-items: stretch; justify-content: stretch; height: 100%;
  }
  .product-gallery__zoom-container {
    overflow: hidden; cursor: zoom-in; position: relative;
    width: 100%; height: 100%; border-radius: 16px; display: flex; align-items: stretch; justify-content: stretch;
  }
  .product-gallery__zoom-container img {
    width: 100%; height: 100%; object-fit: cover; display: block;
    transition: transform 0.4s ease; border-radius: 16px;
    transform-origin: center center;
  }
  .product-gallery__zoom-container:hover img { 
    transform: scale(1.5); 
    transition: transform 0.4s ease;
  }

  /* ===== PRODUCT INFO ===== */
  .product-info { position: relative; }
  @media (min-width: 900px) {
    .product-info__scroll {
      position: sticky; top: 80px;
      max-height: calc(100vh - 100px);
      display: flex; flex-direction: column;
    }
    .product-info__body {
      flex: 1; overflow-y: auto; padding-right: 8px;
    }
    .product-info__body::-webkit-scrollbar { width: 3px; }
    .product-info__body::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 2px; }
  }

  /* Social proof - more prominent */
  .product-social-proof {
    display: flex; align-items: center; gap: 8px;
    background: rgba(190,52,78,0.06); border: 1px solid rgba(190,52,78,0.12);
    border-radius: 50px; padding: 6px 14px; margin-bottom: 16px; font-size: 13px;
    max-width: 100%;
  }
  .proof-avatars { display: flex; flex-shrink: 0; }
  .proof-avatar {
    width: 26px; height: 26px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    color: white; font-weight: 700; font-size: 11px;
    margin-right: -8px; border: 2px solid white;
  }
  .proof-text { 
    margin-left: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .proof-highlight { color: var(--color-primary); font-size: 13px; }

  /* Title â€” Cormorant Garamond */
  .product-title {
    font-family: var(--font-heading) !important;
    font-size: clamp(1.6rem, 3vw, 2.2rem);
    line-height: 1.25; margin-bottom: 8px;
    color: var(--color-text);
    font-weight: 500;
  }

  /* Rating */
  .product-rating { display: flex; align-items: center; gap: 6px; margin-bottom: 12px; }
  .rating-stars { color: #E6CDA9; font-size: 18px; letter-spacing: 1px; }
  .rating-score { font-weight: 700; font-size: 15px; font-family: var(--font-body); color: var(--color-text); }
  .rating-count { color: var(--color-text-muted); font-size: 14px; font-family: var(--font-body); }

  /* Price â€” Cherry Red */
  .product-price { display: flex; align-items: baseline; gap: 12px; margin-bottom: 6px; }
  .main-product .price-current { font-size: 28px; font-weight: 700; color: var(--color-sale) !important; font-family: var(--font-body); }
  .main-product .price-compare { font-size: 18px; color: var(--color-compare) !important; text-decoration: line-through; font-family: var(--font-body); }
  .product-curated-tag {
    display: inline-flex; align-items: center; gap: 6px;
    font-family: var(--font-body);
    font-size: 11px; font-weight: 500; letter-spacing: 0.1em; text-transform: uppercase;
    color: var(--color-text-light);
    margin-bottom: 14px;
  }
  .product-curated-tag svg { color: var(--color-accent-warm); }

  /* Short desc */
  .product-short-desc { color: var(--color-text-muted); font-size: 14px; line-height: 1.7; margin-bottom: 16px; font-family: var(--font-body); }

  /* Features - clear contrast without hard white */
  .product-features {
    background: transparent; border: 1px dashed var(--color-border);
    border-radius: 12px; padding: 18px 20px; margin-bottom: 20px;
    box-shadow: none;
  }
  .product-feature { display: flex; gap: 12px; margin-bottom: 12px; font-size: 14px; line-height: 1.5; }
  .product-feature:last-child { margin-bottom: 0; }
  .feature-icon { font-size: 18px; flex-shrink: 0; margin-top: 1px; }

  /* Variants */
  .product-variants { margin-bottom: 20px; }
  .variant-group { margin-bottom: 16px; }
  .variant-group:last-child { margin-bottom: 0; }
  .variant-label { font-size: 14px; margin-bottom: 8px; font-weight: 400; }
  .variant-options-row {
    display: flex; gap: 8px; flex-wrap: wrap; align-items: center;
  }
  .variant-pill {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 8px 18px;
    border: 1.5px solid var(--color-border);
    border-radius: 50px;
    background: var(--color-white);
    font-family: var(--font-body);
    font-size: 13px; font-weight: 500;
    color: var(--color-text);
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
  }
  .variant-pill:hover { border-color: rgba(190,52,78,0.4); }
  .variant-pill.active {
    border-color: var(--color-primary);
    background: rgba(190,52,78,0.06);
    color: var(--color-primary);
    font-weight: 600;
    box-shadow: 0 0 0 1px var(--color-primary);
  }

  /* Shipping timer card */
  .product-shipping-card {
    display: flex; align-items: center; gap: 8px;
    font-size: 13px; color: var(--color-text-muted);
    border: 1px solid var(--color-border); border-radius: 10px;
    padding: 12px 16px; margin-bottom: 12px;
    background: rgba(0,0,0,0.01);
  }

  /* Free shipping countdown */
  .product-countdown {
    display: flex; align-items: center; gap: 10px;
    background: linear-gradient(135deg, #fff3e0, #fff8f0);
    border: 1px solid #ffe0b2; border-radius: 10px;
    padding: 12px 16px; margin-bottom: 20px; font-size: 13px;
  }
  .countdown-icon { font-size: 20px; }
  .countdown-timer { display: inline-flex; gap: 4px; margin-left: 6px; }
  .countdown-unit {
    background: var(--color-text); color: white;
    padding: 2px 6px; border-radius: 4px; font-weight: 700; font-size: 12px;
  }

  /* ===== REFINED PURCHASE AREA (pinned footer) ===== */
  .product-purchase { 
    flex-shrink: 0; background: var(--color-bg); z-index: 10;
    padding: 8px 0 4px; border-top: 1px solid rgba(0,0,0,0.05);
    box-shadow: 0 -10px 20px var(--color-bg);
  }
  .purchase-trust-center {
    display: flex; align-items: center; justify-content: center; gap: 5px;
    color: var(--color-primary); font-size: 11px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.5px;
    margin-bottom: 4px;
  }
  .purchase-payments-center {
    display: flex; align-items: center; justify-content: center; gap: 5px;
    margin-bottom: 8px;
  }
  .purchase-payments-center .cdraw-payment-icon {
    width: 40px; height: 26px; border-radius: 3px;
    display: inline-flex; overflow: hidden;
  }
  .purchase-payments-center .cdraw-payment-icon svg { width: 100%; height: 100%; }
  
  .secure-checkout-text {
    display: flex; align-items: center; gap: 4px;
    color: var(--color-success, #2e7d32); font-size: 10px; font-weight: 700;
    margin-right: 6px; white-space: nowrap;
  }
  
  .purchase-meta-row {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 10px; padding: 0 4px;
  }
  .purchase-warranty {
    display: flex; align-items: center; gap: 4px;
    color: var(--color-primary); font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;
  }
  .purchase-hint-link {
    background: transparent; border: none; cursor: pointer;
    display: flex; align-items: center; gap: 4px;
    color: var(--color-text-light); font-size: 12px; font-weight: 500;
    transition: color 0.2s; padding: 0;
  }
  .purchase-hint-link:hover { color: var(--color-primary); }

  .purchase-action-row {
    display: flex; gap: 8px; align-items: stretch; height: 50px;
    margin-bottom: 12px;
  }
  
  .purchase-qty-wrapper {
    flex: 0 0 100px;
  }
  .purchase-qty {
    display: flex; align-items: center; justify-content: space-between;
    height: 100%; border: none; border-radius: var(--radius-full);
    background: var(--color-bg-warm); overflow: hidden; padding: 0 4px;
  }
  .purchase-qty .qty-btn {
    width: 28px; height: 100%; border: none; background: transparent;
    font-size: 16px; cursor: pointer; color: var(--color-text);
  }
  .purchase-qty input {
    width: 28px; text-align: center; border: none; background: transparent;
    font-size: 14px; font-weight: 600; color: var(--color-text); padding: 0; outline: none;
    -moz-appearance: textfield; -webkit-appearance: none; appearance: none;
  }
  .purchase-qty input::-webkit-outer-spin-button,
  .purchase-qty input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  
  .purchase-form { flex: 1; margin: 0; }
  .purchase-submit-btn {
    width: 100%; height: 100%;
    background: var(--color-primary); color: #FFFFFF;
    border: none; border-radius: 50px;
    font-family: var(--font-body);
    font-size: 13px; font-weight: 700; letter-spacing: 0.5px;
    cursor: pointer; transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    box-shadow: 0 4px 15px rgba(225, 29, 72, 0.25);
  }
  .purchase-submit-btn:hover {
    background: var(--color-primary-dark);
    box-shadow: 0 6px 20px rgba(225, 29, 72, 0.35);
  }
  .purchase-submit-btn:active {
    transform: scale(0.96) translateY(2px) !important;
    transition: transform 0.08s ease !important;
  }
  .purchase-submit-btn:disabled {
    background: #ccc; cursor: not-allowed; transform: none; box-shadow: none;
  }

  .cdraw-payments { display: flex; justify-content: center; flex-wrap: wrap; gap: 4px; margin-top: 12px; }
  .cdraw-payment-icon { width: 34px; height: 22px; border-radius: 3px; overflow: hidden; display: inline-flex; border: none; }
  .cdraw-payment-icon svg { width: 100%; height: 100%; }

  /* Trust badges - horizontal */
  .product-trust {
    display: flex; flex-wrap: wrap; gap: 0;
    margin: 16px 0; padding: 16px 0; border-top: 1px solid var(--color-border);
    border-bottom: 1px solid var(--color-border);
  }
  .trust-item {
    display: flex; align-items: center; gap: 6px;
    font-size: 12px; font-weight: 500; color: var(--color-text);
    width: 50%; padding: 6px 0;
  }

  /* Accordions */
  .product-accordions { }
  .product-accordion { border-bottom: 1px solid #E8D7EE; }
  .product-accordion summary {
    padding: 14px 0; font-size: 14px; font-weight: 600;
    cursor: pointer; list-style: none;
    display: flex; justify-content: space-between; align-items: center;
  }
  .product-accordion summary::-webkit-details-marker { display: none; }
  .product-accordion summary::after { content: "+"; font-size: 18px; color: var(--color-primary); font-weight: 300; }
  .product-accordion[open] summary::after { content: "âˆ’"; }
  .accordion-content { padding: 4px 0 16px; font-size: 13px; color: var(--color-text-muted); line-height: 1.75; }
  .accordion-content p { margin-bottom: 10px; }
  .accordion-content p:last-child { margin-bottom: 0; }
  .accordion-content ul { margin: 8px 0; padding-left: 20px; }
  .accordion-content li { margin-bottom: 4px; }

  /* ===== UPSELL SECTION ===== */
  .product-upsell {
    background: var(--color-bg-warm);
    border: 1px solid var(--color-border); border-radius: var(--radius-lg); padding: 14px;
    margin-bottom: 24px;
  }
  .upsell-header {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;
  }
  .upsell-title { font-weight: 700; display: flex; align-items: center; gap: 8px; font-size: 15px; }
  .upsell-badge {
    background: var(--color-primary-light); color: var(--color-primary-dark); font-size: 11px; font-weight: 700;
    padding: 6px 12px; border-radius: 20px; text-transform: uppercase; letter-spacing: 0.5px;
  }
  .upsell-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
  .upsell-tag {
    background: transparent; border: 1px solid var(--color-primary-light); color: var(--color-text-muted);
    font-size: 13px; font-weight: 600; padding: 6px 14px; border-radius: 20px;
    transition: all 0.2s;
  }
  .upsell-tag.active-tag {
    background: var(--color-primary); color: var(--color-white); border-color: var(--color-primary);
  }
  .upsell-items { display: flex; flex-direction: column; gap: 6px; }
  .upsell-item {
    display: flex; gap: 12px; padding: 10px; border: 2px solid transparent; border-radius: var(--radius-lg);
    background: transparent; cursor: pointer; transition: all 0.2s;
    align-items: center; margin-bottom: 4px;
  }
  .upsell-item:hover { background: var(--color-bg-surface); }
  .upsell-item.is-checked { border-color: var(--color-primary); background: var(--color-bg-surface); }

  .upsell-checkbox { position: absolute; opacity: 0; cursor: pointer; height: 0; width: 0; }
  .custom-checkbox {
    width: 22px; height: 22px; border: 2px solid var(--color-border); border-radius: 6px;
    display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    transition: all 0.2s; background: white;
  }
  .upsell-item:hover .custom-checkbox { border-color: var(--color-primary); }
  .upsell-checkbox:checked ~ .custom-checkbox {
    background: var(--color-primary); border-color: var(--color-primary); border-radius: 50%;
  }
  .upsell-checkbox:checked ~ .custom-checkbox::after {
    content: ''; width: 4px; height: 10px; border: solid white;
    border-width: 0 2px 2px 0; transform: rotate(45deg); margin-bottom: 2px;
  }
  .upsell-img { width: 68px; height: 68px; border-radius: var(--radius-md); object-fit: cover; flex-shrink: 0; background: transparent; border: 1px solid var(--color-border); }
  .upsell-info { display: flex; flex-direction: column; justify-content: center; flex: 1; }
  .upsell-name { font-size: 14px; font-weight: 600; line-height: 1.4; margin-bottom: 4px; color: var(--color-text); }
  .upsell-price { font-size: 14px; font-weight: 700; color: var(--color-primary); }

  /* Bundle Total Area */
  .upsell-bundle-container {
    margin-top: 8px; padding: 12px 16px; background: var(--color-bg-warm);
    border: 1px solid var(--color-border); border-radius: var(--radius-lg);
  }
  .bundle-summary { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
  .bundle-text { font-size: 14px; color: var(--color-text-muted); }
  .bundle-price-wrap { display: flex; align-items: center; gap: 8px; }
  .bundle-price-final { font-size: 18px; font-weight: 700; color: var(--color-text); }
  .bundle-price-original { font-size: 13px; color: var(--color-text-light); text-decoration: line-through; }
  .bundle-savings-text { font-size: 13px; font-weight: 600; color: var(--color-success); margin-bottom: 16px; }
  .bundle-add-btn {
    width: 100%; padding: 16px; background: var(--color-primary); color: white;
    font-size: 14px; font-weight: 600; border: none; border-radius: var(--radius-full);
    display: flex; justify-content: center; align-items: center; gap: 8px;
    cursor: pointer; transition: all 0.3s; letter-spacing: 1px; text-transform: uppercase;
  }
  .bundle-add-btn:hover { background: var(--color-primary-dark); transform: translateY(-1px); box-shadow: 0 4px 16px rgba(183, 110, 121, 0.3); }

  /* ===== EMOTIONAL STORY SECTION ===== */
  .product-story {
    background: #F9F8F3;
    padding: 60px 20px 80px;
  }
  .product-story__inner { max-width: 680px; margin: 0 auto; }
  .story-emotional { }
  .story-emotional p {
    font-family: var(--font-heading);
    font-style: italic;
    font-size: clamp(1.05rem, 2vw, 1.2rem);
    line-height: 1.9;
    color: var(--color-text);
    margin-bottom: 24px;
    text-align: left;
  }
  .story-emotional p:first-child {
    font-weight: 600;
    font-style: normal;
    font-size: clamp(1.1rem, 2.2vw, 1.3rem);
    margin-bottom: 28px;
  }
  .story-emotional ul {
    list-style: none;
    padding: 0; margin: 0;
    display: flex; flex-direction: column; gap: 14px;
    border-top: 1px solid rgba(29,29,29,0.08);
    padding-top: 28px;
  }
  .story-emotional ul li {
    display: flex; align-items: center; gap: 12px;
    font-family: var(--font-body);
    font-size: 13px;
    color: var(--color-text-muted);
    line-height: 1.5;
    font-style: normal;
  }
  .story-emotional ul li::before {
    content: '';
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--color-accent-warm);
    flex-shrink: 0;
  }
  .story-emotional strong {
    font-weight: 600;
    color: var(--color-text);
  }

  /* ===== STICKY BOTTOM BAR ===== */
  .product-sticky-bar {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: rgba(253, 242, 244, 0.85);
    backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    z-index: 999; transform: translateY(100%);
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    box-shadow: 0 -4px 30px rgba(0,0,0,0.06);
  }
  .product-sticky-bar.visible { transform: translateY(0); }
  .sticky-bar__inner { max-width: 1400px; margin: 0 auto; padding: 14px 32px; }
  .sticky-bar__content { padding: 0; }
  .sticky-bar__main-row { display: flex; align-items: center; justify-content: space-between; gap: 32px; width: 100%; }

  .sticky-bar__info { flex: 0 1 auto; min-width: 0; display: flex; align-items: center; gap: 14px; }
  .sticky-bar__img { width: 50px; height: 50px; border-radius: 12px; object-fit: cover; flex-shrink: 0; border: 1px solid var(--color-border); }
  .sticky-bar__text { display: flex; flex-direction: column; gap: 4px; }
  .sticky-bar__title { font-family: var(--font-body); font-size: 14px; font-weight: 600; color: var(--color-text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.2; max-width: 220px; }
  .sticky-bar__price-row { display: flex; align-items: center; gap: 8px; }
  .sticky-bar__price { font-size: 17px; font-weight: 700; color: var(--color-primary); line-height: 1; }
  .sticky-bar__compare { text-decoration: line-through; opacity: 0.4; font-size: 13px; font-weight: 400; line-height: 1; }

  .sticky-bar__center {
    display: flex; flex-direction: column; align-items: center; gap: 6px;
    flex: 1; min-width: 0;
  }
  .sticky-bar__trust-row {
    display: flex; align-items: center; gap: 8px; justify-content: center;
  }
  .sticky-bar__dot { color: var(--color-text-light); font-size: 16px; font-weight: 300; }
  .sticky-warranty {
    display: flex; align-items: center; gap: 5px;
    color: var(--color-primary); font-size: 12px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.5px;
  }
  .sticky-bar__secure-text {
    display: flex; align-items: center; gap: 4px;
    color: var(--color-success, #2e7d32); font-size: 11px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.3px;
  }
  .sticky-bar__payment-icons { display: flex; align-items: center; gap: 7px; justify-content: center; }
  .sticky-bar__payment-icons .cdraw-payment-icon { width: 42px; height: 26px; border-radius: 3px; display: inline-flex; overflow: hidden; }
  .sticky-bar__payment-icons .cdraw-payment-icon svg { width: 100%; height: 100%; }

  .sticky-bar__actions { display: flex; align-items: center; gap: 12px; flex-shrink: 0; }
  .sticky-bar__qty {
    display: flex; align-items: center;
    border: 1.5px solid var(--color-border); border-radius: 999px;
    height: 44px; background: var(--color-bg-warm); overflow: hidden;
  }
  .sticky-bar__qty .qty-btn {
    width: 36px; height: 100%; border: none; background: transparent;
    font-size: 17px; cursor: pointer; color: var(--color-text);
    transition: background 0.2s; display: flex; align-items: center; justify-content: center;
  }
  .sticky-bar__qty .qty-btn:hover { background: rgba(0,0,0,0.06); }
  .sticky-bar__qty input {
    width: 34px; height: 100%; text-align: center; border: none;
    font-size: 14px; font-weight: 600; background: transparent; color: var(--color-text);
    border-left: 1.5px solid var(--color-border); border-right: 1.5px solid var(--color-border);
    -moz-appearance: textfield; -webkit-appearance: none; appearance: none; padding: 0;
  }
  .sticky-bar__qty input::-webkit-outer-spin-button,
  .sticky-bar__qty input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  .sticky-bar__buy {
    height: 48px; padding: 0 36px;
    background: var(--color-primary); color: var(--color-white);
    border: none; border-radius: 999px;
    font-weight: 700; font-size: 14px;
    cursor: pointer; white-space: nowrap;
    transition: all 0.3s ease;
    letter-spacing: 0.8px; text-transform: uppercase;
    box-shadow: 0 4px 20px rgba(157,95,27,0.35);
    display: flex; align-items: center; gap: 8px;
  }
  .sticky-bar__buy:hover {
    background: var(--color-primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 8px 28px rgba(157,95,27,0.45);
  }
  .sticky-buy__icon { font-size: 15px; }
  .sticky-buy__label { }

  /* ===== MOBILE ===== */
  @media (max-width: 900px) {
    /* Remove stacking context so fixed sticky bar stays on top of everything */
    .main-product .product-container,
    .main-product .product-story { z-index: auto !important; }

    /* Container */
    .product-container { padding: 0 16px; overflow: hidden; }

    /* Gallery: horizontal thumbs below image */
    .product-gallery { flex-direction: column-reverse; gap: 8px; }
    .product-gallery__main { margin-left: 0 !important; }
    .product-gallery__thumbs {
      position: relative !important;
      flex-direction: row; width: 100% !important; max-height: none;
      overflow-x: auto; overflow-y: hidden;
      gap: 6px; padding-right: 0;
      scrollbar-width: thin; scrollbar-color: rgba(0,0,0,0.12) transparent;
    }
    .product-gallery__thumbs::-webkit-scrollbar { height: 2px; }
    .product-gallery__thumbs::-webkit-scrollbar-track { background: transparent; }
    .product-gallery__thumbs::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.10); border-radius: 2px; }
    .product-gallery__thumb { width: 56px; height: 56px; flex-shrink: 0; }
    .product-gallery__zoom-container:hover img { transform: none; }

    /* Social proof â€” compact for mobile */
    .product-social-proof {
      flex-wrap: nowrap; padding: 5px 10px; border-radius: 50px;
      gap: 6px; margin-bottom: 12px; font-size: 11px;
      justify-content: center;
    }
    .proof-avatars { display: flex; flex-shrink: 0; }
    .proof-avatar { width: 20px; height: 20px; font-size: 9px; margin-right: -6px; border-width: 1.5px; }
    .proof-text {
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      font-size: 11px; margin-left: 4px;
    }

    /* Title */
    .product-title { font-size: 1.4rem !important; word-wrap: break-word; }

    /* Variant pills â€” slightly smaller on mobile */
    .variant-pill { padding: 6px 14px; font-size: 12px; }

    /* Features box */
    .product-features { padding: 14px 14px; }
    .product-feature { font-size: 13px; gap: 10px; }

    /* Trust badges â€” compact & centered */
    .trust-item { font-size: 11px; gap: 4px; }
    .trust-item svg { width: 16px; height: 16px; }
    .product-trust { justify-content: center; }

    /* Shipping / countdown â€” centered */
    .product-shipping-card { justify-content: center; font-size: 12px; }
    .product-countdown { justify-content: center; font-size: 12px; }

    /* Purchase area â€” becomes sticky at bottom on mobile */
    .product-purchase {
      display: flex !important;
      position: fixed !important;
      bottom: 0; left: 0; right: 0;
      background: rgba(253, 242, 244, 0.85) !important;
      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
      z-index: 9999 !important;
      padding: 8px 16px 12px !important;
      margin-top: 0 !important;
      border-top: 1px solid rgba(255, 255, 255, 0.2) !important;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.06) !important;
      flex-direction: column;
    }
    /* Compact trust badges in mobile sticky */
    .product-purchase .purchase-trust-center {
      font-size: 9px; gap: 3px; margin-bottom: 2px; letter-spacing: 0.3px;
    }
    .product-purchase .purchase-trust-center svg { width: 10px; height: 10px; }
    .product-purchase .purchase-payments-center {
      margin-bottom: 6px; gap: 3px;
    }
    .product-purchase .purchase-payments-center .cdraw-payment-icon {
      width: 30px; height: 19px;
    }
    .product-purchase .secure-checkout-text { font-size: 8px; margin-right: 4px; }
    .product-purchase .secure-checkout-text svg { width: 9px; height: 9px; }
    .product-purchase #copy-success-msg { display: none !important; }
    .purchase-action-row { height: 46px; margin-bottom: 0; }
    .purchase-qty-wrapper { flex: 0 0 90px; }
    .purchase-submit-btn { font-size: 12px !important; letter-spacing: 0.3px; }

    /* Hide the generic sticky bar on mobile (purchase area replaces it) */
    .product-sticky-bar { display: none !important; }

    /* Upsell section â€” compact */
    .product-upsell { padding: 12px; }
    .upsell-header { flex-wrap: wrap; gap: 8px; }
    .upsell-item { padding: 8px; gap: 10px; }
    .upsell-img { width: 56px; height: 56px; }
    .upsell-name { font-size: 13px; }

    /* Story section */
    .product-story { padding: 40px 16px 60px; }

    /* Add bottom padding so content isn't hidden behind sticky bar */
    .main-product { padding-bottom: 70px; }
  }

  /* ===== UI Enhancements ===== */
  .upsell-rating { font-size: 11px; margin-bottom: 4px; display: flex; align-items: center; gap: 4px; }
  .upsell-rating .u-stars { color: #f5a623; letter-spacing: 1px; font-size: 12px; }
  .upsell-price-row { display: flex; align-items: baseline; gap: 6px; }
  .upsell-compare { font-size: 12px; color: var(--color-text-muted); text-decoration: line-through; opacity: 0.7; }

  .product-purchase { 
    position: sticky; bottom: 0; background: var(--color-bg); z-index: 10;
    padding: 15px 0 20px; border-top: 1px solid rgba(0,0,0,0.05); margin-top: 20px;
    box-shadow: 0 -15px 30px var(--color-bg);
  }

  .scroll-prompt {
    position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
    display: flex; align-items: center; justify-content: center;
    color: var(--color-primary); opacity: 0; visibility: hidden; z-index: 20;
    pointer-events: none; transition: opacity 0.5s ease;
  }
  @media (min-width: 900px) {
    .scroll-prompt.visible { opacity: 0.6; visibility: visible; }
  }
  .scroll-prompt svg { animation: bounce 2s infinite; }
  @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(4px); } 60% { transform: translateY(2px); } }
</style>

<script>
  // ===== Scroll Indicator =====
  const scrollArea = document.getElementById('product-scroll-area');
  const scrollPrompt = document.getElementById('scroll-prompt');
  
  if (scrollArea && scrollPrompt) {
    const checkScroll = () => {
      if (scrollArea.scrollHeight > scrollArea.clientHeight + 40) {
        if (scrollArea.scrollTop + scrollArea.clientHeight < scrollArea.scrollHeight - 60) {
          scrollPrompt.classList.add('visible');
        } else {
          scrollPrompt.classList.remove('visible');
        }
      } else {
        scrollPrompt.classList.remove('visible');
      }
    };
    
    setTimeout(checkScroll, 800);
    scrollArea.addEventListener('scroll', checkScroll);
    window.addEventListener('resize', checkScroll);
    
    // Also check on variant mix/match changing height
    document.querySelectorAll('.product-accordion summary').forEach(el => {
      el.addEventListener('click', () => setTimeout(checkScroll, 300));
    });
  }

  // ===== Copy URL Feature =====
  function copyProductUrl() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
      const msg = document.getElementById('copy-success-msg');
      if (msg) {
        msg.style.display = 'block';
        setTimeout(() => {
          msg.style.display = 'none';
        }, 3500);
      }
    }).catch(err => {
      console.error('Failed to copy text: ', err);
    });
  }
  // ===== Thumbnail click â†’ change main image =====
  document.querySelectorAll('.product-gallery__thumb').forEach(thumb => {
    thumb.addEventListener('click', function() {
      document.querySelectorAll('.product-gallery__thumb').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      const mainImg = document.getElementById('product-main-image');
      if (mainImg && this.dataset.full) {
        mainImg.src = this.dataset.full;
      }
    });
  });

  // ===== Variant selector (option-based) â†’ find matching variant =====
  const allVariants = {{ product.variants | json }};
  const variantGroups = document.querySelectorAll('.variant-group');
  const variantIdInput = document.getElementById('product-variant-id');

  function getSelectedOptions() {
    const selected = [];
    variantGroups.forEach(group => {
      const activeBtn = group.querySelector('.variant-pill.active');
      if (activeBtn) selected.push(activeBtn.dataset.optionValue);
    });
    return selected;
  }

  function findMatchingVariant(selectedOpts) {
    return allVariants.find(v => {
      return selectedOpts.every((val, i) => v.options[i] === val);
    });
  }

  function updateVariantUI(variant) {
    if (!variant) return;
    // Update hidden input
    if (variantIdInput) variantIdInput.value = variant.id;
    // Update price
    const priceEl = document.querySelector('.price-current');
    if (priceEl) priceEl.textContent = (variant.price / 100).toLocaleString('en-US', { style: 'currency', currency: 'USD' });
    const compareEl = document.querySelector('.price-compare');
    if (compareEl) {
      if (variant.compare_at_price && variant.compare_at_price > variant.price) {
        compareEl.textContent = (variant.compare_at_price / 100).toLocaleString('en-US', { style: 'currency', currency: 'USD' });
        compareEl.style.display = '';
      } else {
        compareEl.style.display = 'none';
      }
    }
    // Update main image
    if (variant.featured_image) {
      const mainImg = document.getElementById('product-main-image');
      if (mainImg) mainImg.src = variant.featured_image.src;
    }
    // Update sticky bar price
    const stickyPrice = document.querySelector('.sticky-price');
    if (stickyPrice) stickyPrice.textContent = (variant.price / 100).toLocaleString('en-US', { style: 'currency', currency: 'USD' });
  }

  variantGroups.forEach(group => {
    group.querySelectorAll('.variant-pill').forEach(btn => {
      btn.addEventListener('click', function() {
        // Update active state within this group
        group.querySelectorAll('.variant-pill').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        // Update the label
        const label = group.querySelector('.variant-selected-value');
        if (label) label.textContent = this.dataset.optionValue;
        // Find and apply matching variant
        const selectedOpts = getSelectedOptions();
        const matchedVariant = findMatchingVariant(selectedOpts);
        updateVariantUI(matchedVariant);
      });
    });
  });

  // ===== Interactive Hover Zoom (Follow Cursor) =====
  const zoomContainer = document.querySelector('.product-gallery__zoom-container');
  const zoomImg = document.getElementById('product-main-image');
  if (zoomContainer && zoomImg) {
    zoomContainer.addEventListener('mousemove', function(e) {
      const rect = zoomContainer.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      // Calculate percentage
      const xPercent = (x / rect.width) * 100;
      const yPercent = (y / rect.height) * 100;
      zoomImg.style.transformOrigin = `${xPercent}% ${yPercent}%`;
    });
    zoomContainer.addEventListener('mouseleave', function() {
      // Reset to center when mouse leaves
      zoomImg.style.transformOrigin = 'center center';
    });
  }

  // ===== Sticky bar visibility =====
  const stickyBar = document.getElementById('product-sticky-bar');
  const purchaseArea = document.getElementById('product-purchase-area');
  if (purchaseArea && stickyBar) {
    const obs = new IntersectionObserver(entries => {
      entries.forEach(e => {
        const isVisible = !e.isIntersecting;
        stickyBar.classList.toggle('visible', isVisible);
        // Add padding to body so the sticky bar doesn't overlap the footer when scrolled to the bottom
        document.body.style.paddingBottom = isVisible ? stickyBar.offsetHeight + 'px' : '';
      });
    }, { threshold: 0 });
    obs.observe(purchaseArea);
  }

  // ===== Quantity controls =====
  function changeProductQty(d) {
    const inp = document.getElementById('product-qty-input');
    let v = Math.max(1, Math.min(10, parseInt(inp.value) + d));
    inp.value = v;
    document.getElementById('product-qty-hidden').value = v;
    document.getElementById('sticky-qty').value = v;
  }
  function changeStickyQty(d) {
    const inp = document.getElementById('sticky-qty');
    let v = Math.max(1, Math.min(10, parseInt(inp.value) + d));
    inp.value = v;
    document.getElementById('product-qty-input').value = v;
    document.getElementById('product-qty-hidden').value = v;
  }

  // ===== Shipping date =====
  (function() {
    const d = new Date(); d.setDate(d.getDate() + 7);
    const el = document.getElementById('shipping-date');
    if (el) el.textContent = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
  })();

  // ===== Free shipping countdown timer =====
  (function() {
    const now = new Date();
    const endOfDay = new Date(now);
    endOfDay.setHours(23, 59, 59, 999);
    function updateCountdown() {
      const now = new Date();
      const diff = endOfDay - now;
      if (diff <= 0) return;
      const h = Math.floor(diff / 3600000);
      const m = Math.floor((diff % 3600000) / 60000);
      const s = Math.floor((diff % 60000) / 1000);
      const hEl = document.getElementById('cd-hours');
      const mEl = document.getElementById('cd-mins');
      const sEl = document.getElementById('cd-secs');
      if (hEl) hEl.textContent = h;
      if (mEl) mEl.textContent = m < 10 ? '0' + m : m;
      if (sEl) sEl.textContent = s < 10 ? '0' + s : s;
    }
    setInterval(updateCountdown, 1000);
    updateCountdown();
  })();

  // ===== Dynamic Upsell Bundle Calculation =====
  function formatMoney(cents) {
    return '$' + (cents / 100).toFixed(2);
  }
  const basePrice = {{ product.price | default: 0 }};
  const upsellCheckboxes = document.querySelectorAll('.upsell-checkbox');
  const bundleContainer = document.getElementById('upsell-bundle-container');
  
  function updateBundle() {
    let checkedCount = 0;
    let extraPrice = 0;
    
    upsellCheckboxes.forEach(cb => {
      const item = cb.closest('.upsell-item');
      if (cb.checked) {
        checkedCount++;
        extraPrice += parseInt(cb.dataset.price || 0);
        item.classList.add('is-checked');
      } else {
        item.classList.remove('is-checked');
      }
    });

    const tag1 = document.getElementById('upsell-tag-1');
    const tag2 = document.getElementById('upsell-tag-2');
    if (tag1 && tag2) {
      if (checkedCount === 1) {
        tag1.classList.add('active-tag');
        tag2.classList.remove('active-tag');
      } else if (checkedCount >= 2) {
        tag1.classList.remove('active-tag');
        tag2.classList.add('active-tag');
      } else {
        tag1.classList.remove('active-tag');
        tag2.classList.remove('active-tag');
      }
    }

    if (checkedCount > 0) {
      bundleContainer.style.display = 'block';
      const totalItems = checkedCount + 1; // +1 for the main product
      let discountPercent = (checkedCount >= 2) ? 0.15 : 0.05;
      
      const subtotal = basePrice + extraPrice;
      const discountAmount = subtotal * discountPercent;
      const finalPrice = subtotal - discountAmount;
      
      document.getElementById('bundle-qty-count').textContent = totalItems;
      document.getElementById('bundle-price-final').textContent = formatMoney(finalPrice);
      document.getElementById('bundle-price-original').textContent = formatMoney(subtotal);
      document.getElementById('bundle-savings-percent').textContent = discountPercent * 100;
      document.getElementById('bundle-savings-amount').textContent = formatMoney(discountAmount);
      document.getElementById('bundle-btn-price').textContent = formatMoney(finalPrice);
    } else {
      bundleContainer.style.display = 'none';
    }
  }

  upsellCheckboxes.forEach(cb => {
    cb.addEventListener('change', updateBundle);
  });

  // ===== AJAX Add to Cart (opens cart drawer instead of navigating) =====
  document.querySelectorAll('.purchase-form').forEach(form => {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const body = {
        id: formData.get('id'),
        quantity: parseInt(formData.get('quantity')) || 1
      };

      const submitBtn = this.querySelector('.purchase-submit-btn');
      const origText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<span class="cta-icon">âœ“</span> ADDING...';
      submitBtn.disabled = true;

      fetch('/cart/add.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      })
      .then(r => r.json())
      .then(data => {
        // Show success briefly
        submitBtn.innerHTML = '<span class="cta-icon">âœ“</span> ADDED TO CART!';
        setTimeout(() => {
          submitBtn.innerHTML = origText;
          submitBtn.disabled = false;
        }, 2000);
        // Open cart drawer
        openCartDrawer();
      })
      .catch(err => {
        console.error('Cart error:', err);
        submitBtn.innerHTML = origText;
        submitBtn.disabled = false;
      });
    });
  });

  // openCartDrawer() is now defined globally in cart-drawer.liquid

  // Sync gallery height with info column so image bottom = Add to Cart bottom
  function syncGalleryHeight() {
    if (window.innerWidth < 900) return; // Mobile: no sync needed
    const info = document.getElementById('product-info-col');
    const gallery = document.querySelector('.product-gallery');
    if (info && gallery) {
      gallery.style.maxHeight = info.offsetHeight + 'px';
    }
  }
  window.addEventListener('load', syncGalleryHeight);
  window.addEventListener('resize', syncGalleryHeight);
  // Re-sync when accordions toggle
  document.querySelectorAll('.product-accordion').forEach(acc => {
    acc.addEventListener('toggle', () => setTimeout(syncGalleryHeight, 50));
  });
</script>

{% schema %}
{
  "name": "Product Information",
  "settings": [],
  "blocks": [
    {
      "type": "upsell",
      "name": "Upsell Product",
      "limit": 3,
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Select Product"
        }
      ]
    },
    {
      "type": "accordion",
      "name": "Accordion Details",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Materials & Care"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Add detailed information here.</p>"
        }
      ]
    }
  ]
}
{% endschema %}
