<section class="main-product">
  <div class="product-container">
    <!-- Breadcrumbs -->
    <nav class="product-breadcrumbs">
      <a href="/">Home</a>
      <span>‚Ä∫</span>
      {%- if product.collections.size > 0 -%}
        <a href="{{ product.collections.first.url }}">{{ product.collections.first.title }}</a>
        <span>‚Ä∫</span>
      {%- endif -%}
      <span>{{ product.title | truncate: 50 }}</span>
    </nav>

    <!-- Two-column Product Hero -->
    <div class="product-hero">
      <!-- LEFT: Image Gallery (wider) -->
      <div class="product-gallery">
        <div class="product-gallery__thumbs">
          {%- for image in product.images -%}
            <div class="product-gallery__thumb {% if forloop.first %}active{% endif %}" data-index="{{ forloop.index0 }}" data-full="{{ image | image_url: width: 900 }}">
              <img src="{{ image | image_url: width: 150 }}" alt="{{ image.alt | default: product.title }}" loading="lazy">
            </div>
          {%- endfor -%}
        </div>
        <div class="product-gallery__main">
          <div class="product-gallery__zoom-container">
            {%- if product.featured_image != blank -%}
              <img id="product-main-image" src="{{ product.featured_image | image_url: width: 900 }}" alt="{{ product.title }}">
            {%- else -%}
              {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
            {%- endif -%}
          </div>
        </div>
      </div>

      <!-- RIGHT: Product Info (narrower, sticky) -->
      <div class="product-info" id="product-info-col">
        <div class="product-info__scroll" id="product-scroll-area">
          <div class="product-info__body">
          <!-- Social proof bar -->
          <div class="product-social-proof">
            <span class="proof-avatars">
              <span class="proof-avatar" style="background:#e8a87c;">S</span>
              <span class="proof-avatar" style="background:#d4a5a5;">M</span>
            </span>
            <span class="proof-text"><strong>sarah.m</strong> ‚úì , <strong>mike.t</strong> ‚úì and <strong class="proof-highlight">8,247</strong> others carry our products.</span>
          </div>

          <!-- Title -->
          <h1 class="product-title">{{ product.title }}</h1>

          <!-- Rating -->
          <div class="product-rating">
            <span class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
            <span class="rating-score">4.9</span>
            <span class="rating-count">(778)</span>
          </div>

          <!-- Price -->
          <div class="product-price">
            <span class="price-current">{{ product.price | money }}</span>
            {%- if product.compare_at_price > product.price -%}
              <span class="price-compare">{{ product.compare_at_price | money }}</span>
            {%- else -%}
              {%- assign hash_val = product.id | modulo: 100 -%}
              {%- assign multiplier = 200 | plus: hash_val -%}
              {%- assign fake_compare_price = product.price | times: multiplier | divided_by: 100 -%}
              <span class="price-compare">{{ fake_compare_price | money }}</span>
            {%- endif -%}
          </div>

          {%- if product.compare_at_price > product.price -%}
            {%- assign savings = product.compare_at_price | minus: product.price -%}
          {%- else -%}
            {%- assign hash_val = product.id | modulo: 100 -%}
            {%- assign multiplier = 200 | plus: hash_val -%}
            {%- assign fake_compare_price = product.price | times: multiplier | divided_by: 100 -%}
            {%- assign savings = fake_compare_price | minus: product.price -%}
          {%- endif -%}
          <div class="product-savings-badge">
            üéâ You save: <strong id="dynamic-savings">{{ savings | money }}</strong>
          </div>

          <!-- Short Description -->
          <div class="product-short-desc">
            <p>Finding a gift that says "I love you" shouldn't feel ordinary. Give her an unforgettable unboxing experience that speaks exactly what's in your heart.</p>
          </div>

          <!-- Feature highlights -->
          <div class="product-features">
            <div class="product-feature">
              <span class="feature-icon">üéÅ</span>
              <div><strong>2-in-1 Surprise:</strong> A luxury apple jewelry box revealing a hidden clover necklace.</div>
            </div>
            <div class="product-feature">
              <span class="feature-icon">üåπ</span>
              <div><strong>Eternal Rose:</strong> Handcrafted from scented soap‚Äîsymbolizing a love that never fades and fills the room with fragrance.</div>
            </div>
            <div class="product-feature">
              <span class="feature-icon">‚ú®</span>
              <div><strong>Ready to Gift:</strong> Includes a deeply emotional "To My Love" message card.</div>
            </div>
          </div>

          <!-- Variant selector -->
          {%- if product.variants.size > 1 -%}
            <div class="product-variants">
              <p class="variant-label">Select Color: <strong id="variant-name" style="color:var(--color-primary);">{{ product.selected_or_first_available_variant.title }}</strong></p>
              <div class="variant-options">
                {%- for variant in product.variants -%}
                  <label class="variant-option {% if variant == product.selected_or_first_available_variant %}active{% endif %}" data-variant-id="{{ variant.id }}" data-variant-title="{{ variant.title }}" data-variant-price="{{ variant.price | money }}" {% if variant.image %}data-variant-image="{{ variant.image | image_url: width: 900 }}"{% endif %}>
                    <input type="radio" name="variant" value="{{ variant.id }}" {% if variant == product.selected_or_first_available_variant %}checked{% endif %}>
                    {%- if variant.image -%}
                      <img src="{{ variant.image | image_url: width: 160 }}" alt="{{ variant.title }}">
                    {%- else -%}
                      <span>{{ variant.title }}</span>
                    {%- endif -%}
                  </label>
                {%- endfor -%}
              </div>
            </div>
          {%- endif -%}

          <!-- Shipping timer -->
          <div class="product-shipping-card">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            <span>Order in the next <strong id="shipping-timer">2h 15m</strong> for delivery by <strong id="shipping-date"></strong></span>
          </div>

          <!-- Free shipping countdown -->
          <div class="product-countdown">
            <div class="countdown-icon">üöö</div>
            <div class="countdown-text">
              <strong>FREE SHIPPING</strong> ends in:
              <span class="countdown-timer" id="free-ship-timer">
                <span class="countdown-unit"><span id="cd-hours">23</span>h</span>
                <span class="countdown-unit"><span id="cd-mins">59</span>m</span>
                <span class="countdown-unit"><span id="cd-secs">59</span>s</span>
              </span>
            </div>
          </div>

          <!-- Trust badges -->
          <div class="product-trust">
            <div class="trust-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2"><path d="M5 12h14"/><path d="M12 5l7 7-7 7"/></svg>
              <span>Free US Shipping</span>
            </div>
            <div class="trust-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
              <span>Lifetime Warranty</span>
            </div>
            <div class="trust-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>
              <span>30-Day Returns</span>
            </div>
            <div class="trust-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
              <span>Secure Checkout</span>
            </div>
          </div>

          <!-- Accordions -->
          <div class="product-accordions">
            {%- assign has_accordions = false -%}
            {%- for block in section.blocks -%}
              {%- if block.type == 'accordion' -%}
                {%- assign has_accordions = true -%}
                <details class="product-accordion" {% if forloop.first %}open{% endif %} {{ block.shopify_attributes }}>
                  <summary>{{ block.settings.heading }}</summary>
                  <div class="accordion-content">
                    {{ block.settings.content }}
                  </div>
                </details>
              {%- endif -%}
            {%- endfor -%}

            {%- if has_accordions == false -%}
              {%- comment -%} Fallback if no blocks are added {%- endcomment -%}
              <details class="product-accordion">
                <summary>The Artisan's Journey</summary>
                <div class="accordion-content">
                  <p>‚Ä¢ Hand-finished by master jewelers with decades of experience</p>
                  <p>‚Ä¢ Crafted using sustainably sourced, conflict-free materials</p>
                  <p>‚Ä¢ Every piece is polished to perfection to symbolize eternal devotion</p>
                  <p>‚Ä¢ Arrives in our signature, eco-friendly luxury packaging</p>
                </div>
              </details>
              <details class="product-accordion">
                <summary>Materials & Care</summary>
                <div class="accordion-content">
                  <p>‚Ä¢ Premium scented soap rose ‚Äî lasts indefinitely with gentle care</p>
                  <p>‚Ä¢ 14K gold/white gold plated necklace ‚Äî tarnish-resistant</p>
                  <p>‚Ä¢ Luxury apple-shaped jewelry box ‚Äî handcrafted with love</p>
                  <p>‚Ä¢ Keep away from water and direct sunlight for lasting beauty</p>
                </div>
              </details>
              <details class="product-accordion">
                <summary>How It Works</summary>
                <div class="accordion-content">
                  <p>Our gifts include beautiful jewelry paired with a luxury rose box‚Äîa timeless symbol of your eternal bond.</p>
                  <p>Wearing the jewelry becomes a meaningful reminder of your love. The included Heart to Soul message card adds an extra touch to celebrate your connection.</p>
                </div>
              </details>
              <details class="product-accordion">
                <summary>Are The Pieces Waterproof?</summary>
                <div class="accordion-content">
                  <p>Of course! We use high-quality materials including 14K white gold or 18K yellow gold finish over premium stainless steel.</p>
                  <p>This means you can wear your jewelry while swimming, showering, or during other water activities without worrying about tarnishing, rust, or discoloration.</p>
                  <p>Your piece remains scratch-resistant, and sweat won't cause any wear over time.</p>
                </div>
              </details>
              <details class="product-accordion">
                <summary>Need Help Choosing The Right Size?</summary>
                <div class="accordion-content">
                  <p><strong>Necklaces:</strong><br>Universally adjustable‚Äîno size selection is needed.<br>(Chain length: 18 inches + 4-inch extension cable chain.)</p>
                  <p><strong>Bracelets:</strong><br>Designed to fit most wrists comfortably with adjustable mechanisms.</p>
                </div>
              </details>
              <details class="product-accordion">
                <summary>Shipping Info</summary>
                <div class="accordion-content">
                  <p>Please allow <strong>1 to 3 days</strong> for us to process, package, and ship your order.</p>
                  <p><strong>Shipping methods and delivery times:</strong></p>
                  <ul>
                    <li style="margin-left: 20px; margin-bottom: 4px;">Standard shipping: 6‚Äì10 days</li>
                    <li style="margin-left: 20px;">Express shipping: 5‚Äì8 days</li>
                  </ul>
                  <p><em>You'll receive a tracking number once your order ships, so you can follow your package every step of the way.</em></p>
                </div>
              </details>
            {%- endif -%}
          </div>

          <!-- Upsell Section -->
          <div class="product-upsell">
            <div class="upsell-header">
              <div class="upsell-title">üî• <span>Special Offers!</span></div>
              <div class="upsell-badge">SAVE UP TO 15%</div>
            </div>
            <div class="upsell-tags">
              <span class="upsell-tag" id="upsell-tag-1">+1 item &rarr; 5% OFF</span>
              <span class="upsell-tag" id="upsell-tag-2">+2 items &rarr; 15% OFF</span>
            </div>
            <div class="upsell-items">
              {%- assign has_upsells = false -%}
              {%- for block in section.blocks -%}
                {%- if block.type == 'upsell' and block.settings.product != blank -%}
                  {%- assign has_upsells = true -%}
                  {%- assign upsell_product = block.settings.product -%}
                  <label class="upsell-item" {{ block.shopify_attributes }}>
                    <input type="checkbox" class="upsell-checkbox" data-variant-id="{{ upsell_product.selected_or_first_available_variant.id }}" data-price="{{ upsell_product.price }}">
                    <span class="custom-checkbox"></span>
                    <img src="{{ upsell_product.featured_image | image_url: width: 150 }}" alt="{{ upsell_product.title | escape }}" class="upsell-img">
                    <div class="upsell-info">
                      <span class="upsell-name">{{ upsell_product.title }}</span>
                      {%- assign h_size = upsell_product.handle | size -%}
                      {%- assign id_shift = upsell_product.id | divided_by: 7 -%}
                      {%- assign upsell_rating_mod = id_shift | plus: h_size | modulo: 4 -%}
                      {%- if upsell_rating_mod == 0 -%}{%- assign u_rating = "5.0" -%}{%- assign u_stars = "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ" -%}
                      {%- elsif upsell_rating_mod == 1 -%}{%- assign u_rating = "4.9" -%}{%- assign u_stars = "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ" -%}
                      {%- elsif upsell_rating_mod == 2 -%}{%- assign u_rating = "4.8" -%}{%- assign u_stars = "‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ" -%}
                      {%- else -%}{%- assign u_rating = "4.7" -%}{%- assign u_stars = "‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ" -%}
                      {%- endif -%}
                      {%- assign u_count = upsell_product.id | modulo: 874 | plus: 128 -%}
                      <div class="upsell-rating"><span class="u-stars">{{ u_stars }}</span> <span class="u-count">{{ u_rating }} ({{ u_count }})</span></div>
                      <div class="upsell-price-row">
                        <span class="upsell-price">{{ upsell_product.price | money }}</span>
                        {%- if upsell_product.compare_at_price > upsell_product.price -%}
                          <span class="upsell-compare">{{ upsell_product.compare_at_price | money }}</span>
                        {%- else -%}
                          {%- assign u_hash = upsell_product.id | modulo: 100 -%}
                          {%- assign u_mult = 200 | plus: u_hash -%}
                          <span class="upsell-compare">{{ upsell_product.price | times: u_mult | divided_by: 100 | money }}</span>
                        {%- endif -%}
                      </div>
                    </div>
                  </label>
                {%- endif -%}
              {%- endfor -%}

              {%- if has_upsells == false -%}
                {%- comment -%} Fallback: Show other products from the same collection {%- endcomment -%}
                {%- assign fallback_products = product.collections.first.products | default: collections.all.products -%}
                {%- assign fallback_count = 0 -%}
                {%- for fp in fallback_products limit: 4 -%}
                  {%- if fp.id != product.id and fallback_count < 3 -%}
                    {%- assign fallback_count = fallback_count | plus: 1 -%}
                    <label class="upsell-item">
                      <input type="checkbox" class="upsell-checkbox" data-variant-id="{{ fp.selected_or_first_available_variant.id }}" data-price="{{ fp.price }}">
                      <span class="custom-checkbox"></span>
                      {%- if fp.featured_image != blank -%}
                        <img src="{{ fp.featured_image | image_url: width: 150 }}" alt="{{ fp.title | escape }}" class="upsell-img">
                      {%- else -%}
                        <div class="upsell-img" style="display:flex;align-items:center;justify-content:center;background:var(--color-bg-warm);font-size:24px;">üíé</div>
                      {%- endif -%}
                      <div class="upsell-info">
                        <span class="upsell-name">{{ fp.title | truncate: 60 }}</span>
                        {%- assign h_size = fp.handle | size -%}
                        {%- assign id_shift = fp.id | divided_by: 7 -%}
                        {%- assign upsell_rating_mod = id_shift | plus: h_size | modulo: 4 -%}
                        {%- if upsell_rating_mod == 0 -%}{%- assign u_rating = "5.0" -%}{%- assign u_stars = "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ" -%}
                        {%- elsif upsell_rating_mod == 1 -%}{%- assign u_rating = "4.9" -%}{%- assign u_stars = "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ" -%}
                        {%- elsif upsell_rating_mod == 2 -%}{%- assign u_rating = "4.8" -%}{%- assign u_stars = "‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ" -%}
                        {%- else -%}{%- assign u_rating = "4.7" -%}{%- assign u_stars = "‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ" -%}
                        {%- endif -%}
                        {%- assign u_count = fp.id | modulo: 874 | plus: 128 -%}
                        <div class="upsell-rating"><span class="u-stars">{{ u_stars }}</span> <span class="u-count">{{ u_rating }} ({{ u_count }})</span></div>
                        <div class="upsell-price-row">
                          <span class="upsell-price">{{ fp.price | money }}</span>
                          {%- if fp.compare_at_price > fp.price -%}
                            <span class="upsell-compare">{{ fp.compare_at_price | money }}</span>
                          {%- else -%}
                            {%- assign f_hash = fp.id | modulo: 100 -%}
                            {%- assign f_mult = 200 | plus: f_hash -%}
                            <span class="upsell-compare">{{ fp.price | times: f_mult | divided_by: 100 | money }}</span>
                          {%- endif -%}
                        </div>
                      </div>
                    </label>
                  {%- endif -%}
                {%- endfor -%}
              {%- endif -%}
            </div>

            <div class="upsell-bundle-container" id="upsell-bundle-container" style="display: none;">
              <div class="bundle-summary">
                <div class="bundle-text">Bundle total (<span id="bundle-qty-count">2</span> items)</div>
                <div class="bundle-price-wrap">
                  <span class="bundle-price-final" id="bundle-price-final">$155.43</span>
                  <span class="bundle-price-original" id="bundle-price-original">$163.61</span>
                </div>
              </div>
              <p class="bundle-savings-text">üéâ You save <span id="bundle-savings-percent">5</span>%: <span id="bundle-savings-amount">$8.18</span></p>
              
              <div class="product-warranty-notice" style="margin-top: 20px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                LIFETIME WARRANTY INCLUDED
              </div>
              
              <button type="button" class="bundle-add-btn" id="bundle-add-btn" onclick="document.querySelector('.product-form__submit').click();">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="8" width="18" height="14" rx="2"/><path d="M8 8V6a4 4 0 0 1 8 0v2"/></svg>
                ADD BUNDLE TO BAG ‚Äî <span id="bundle-btn-price">$155.43</span>
              </button>
            </div>
          </div>
          </div><!-- /.product-info__body -->

          <!-- Product Purchase Area (pinned footer) -->
          <div class="product-purchase" id="product-purchase-area">
            <div id="copy-success-msg" style="display: none; color: var(--color-success); font-size: 12px; text-align: center; margin-bottom: 4px;">
              Link secured! üíÖ
            </div>

            <!-- WARRANTY (centered) -->
            <div class="purchase-trust-center">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
              LIFETIME WARRANTY
            </div>

            <!-- Payment logos (centered) -->
            <div class="purchase-payments-center">
              <span class="cdraw-payment-icon" title="Visa"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#1A1F71"/><text x="24" y="20" text-anchor="middle" fill="#FFFFFF" font-size="11" font-weight="700" font-family="Arial">VISA</text></svg></span>
              <span class="cdraw-payment-icon" title="Mastercard"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#252525"/><circle cx="19" cy="16" r="9" fill="#EB001B"/><circle cx="29" cy="16" r="9" fill="#F79E1B"/><path d="M24 9.5a9 9 0 0 1 0 13" fill="#FF5F00"/></svg></span>
              <span class="cdraw-payment-icon" title="American Express"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#006FCF"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="7" font-weight="700" font-family="Arial">AMEX</text></svg></span>
              <span class="cdraw-payment-icon" title="Discover"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#FF6600"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="7" font-weight="700" font-family="Arial">DISCOVER</text></svg></span>
              <span class="cdraw-payment-icon" title="Apple Pay"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#000000"/><text x="24" y="19" text-anchor="middle" fill="#FFFFFF" font-size="8" font-weight="500" font-family="Arial"> Pay</text></svg></span>
              <span class="cdraw-payment-icon" title="PayPal"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#003087"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="8" font-weight="700" font-family="Arial">PayPal</text></svg></span>
              <span class="cdraw-payment-icon" title="Shop Pay"><svg viewBox="0 0 48 32" width="32" height="21"><rect width="48" height="32" rx="4" fill="#5A31F4"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="7" font-weight="600" font-family="Arial">Shop Pay</text></svg></span>
            </div>

            <!-- Qty + Add to Bag -->
            <div class="purchase-action-row">
              <div class="purchase-qty-wrapper">
                <div class="purchase-qty">
                  <button type="button" class="qty-btn" onclick="changeProductQty(-1)">‚àí</button>
                  <input type="number" id="product-qty-input" value="1" min="1" max="10">
                  <button type="button" class="qty-btn" onclick="changeProductQty(1)">+</button>
                </div>
              </div>

              {%- form 'product', product, class: 'purchase-form' -%}
                <input type="hidden" name="id" id="product-variant-id" value="{{ product.selected_or_first_available_variant.id }}">
                <input type="hidden" name="quantity" id="product-qty-hidden" value="1">
                <button type="submit" class="purchase-submit-btn" {% unless product.available %}disabled{% endunless %}>
                  {%- if product.available -%}
                    ‚ô° ADD TO BAG ‚Äî {{ product.price | money }}
                  {%- else -%}
                    SOLD OUT
                  {%- endif -%}
                </button>
              {%- endform -%}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- The Story Behind the Gift -->
  <div class="product-story">
    <div class="product-story__inner">
      <div class="story-icon">‚ô°</div>
      <h2 class="story-title">The Story Behind the Gift</h2>
      <div class="story-divider"></div>
      <div class="story-text">
        <p>At first glance, it is a beautifully crafted, vibrant Red Apple‚Äîa timeless symbol of temptation, romance, and devotion. But the true magic happens when she opens it.</p>
        <p>Inside blooms a stunning, handcrafted Eternal Rose. Unlike real flowers that quickly wither, this masterpiece is delicately sculpted from premium, fragrant soap. It not only looks as though it was just carefully selected from a lush garden, but it also fills the room with a soft, romantic scent that lasts indefinitely.</p>
      </div>
      <div class="story-highlight">
        <h3>üíï The Hidden Gem</h3>
        <p>Beneath the eternal rose lies a secret drawer. Pull it gently to reveal a dazzling clavicle chain necklace resting on a deeply emotional message card.</p>
      </div>
      <div class="story-message">
        <p class="message-text"><em>"I am not perfect. I annoy you, forget stuff, say stupid things and more... But you will never find someone who loves you like I do. I LOVE YOU FOREVER."</em></p>
      </div>
    </div>
  </div>
</section>

<!-- Sticky bottom bar (full-width, shows on scroll) -->
<div class="product-sticky-bar" id="product-sticky-bar">
  <div class="sticky-bar__inner">
    <div class="sticky-bar__content">
      <div class="sticky-bar__main-row">
        <div class="sticky-bar__info">
          {%- if product.featured_image != blank -%}
            <img src="{{ product.featured_image | image_url: width: 100 }}" alt="{{ product.title | escape }}" class="sticky-bar__img">
          {%- endif -%}
          <div class="sticky-bar__text">
            <p class="sticky-bar__title">{{ product.title | truncate: 45 }}</p>
            <div class="sticky-bar__price-row">
              {%- assign current_price = product.price | default: 9468 -%}
              {%- if product.compare_at_price > product.price -%}
                {%- assign compare_price = product.compare_at_price -%}
              {%- else -%}
                {%- assign hash_val = product.id | modulo: 100 -%}
                {%- assign multiplier = 200 | plus: hash_val -%}
                {%- assign fake_compare_price = product.price | times: multiplier | divided_by: 100 -%}
                {%- assign compare_price = fake_compare_price | default: 18936 -%}
              {%- endif -%}
              {%- assign savings = compare_price | minus: current_price -%}
              
              <span class="sticky-bar__price">{{ current_price | money }}</span>
              <span class="sticky-bar__compare">{{ compare_price | money }}</span>
              <span class="sticky-bar__savings">SAVE {{ savings | money }}</span>
            </div>
          </div>
        </div>
        
        <div class="sticky-bar__actions">
          <button type="button" class="sticky-hint-btn" onclick="copyProductUrl()" title="Share as a gift hint">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
            <span>Hint</span>
          </button>

          <div class="sticky-bar__qty">
            <button class="qty-btn" onclick="changeStickyQty(-1)">‚àí</button>
            <input type="number" id="sticky-qty" value="1" min="1" max="10">
            <button class="qty-btn" onclick="changeStickyQty(1)">+</button>
          </div>

          <button class="sticky-bar__buy" onclick="document.querySelector('.purchase-submit-btn').click();">
            <span class="sticky-buy__icon">‚ô°</span>
            <span class="sticky-buy__label">ADD TO BAG</span>
            <span class="sticky-buy__price">{{ current_price | money }}</span>
          </button>
        </div>
      </div>
      
      <!-- Combined Warranty + Payment Icons (single centered row) -->
      <div class="sticky-bar__trust-row">
        <div class="sticky-warranty">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          LIFETIME WARRANTY
        </div>
        <span class="sticky-bar__divider">|</span>
        <div class="sticky-bar__payment-icons">
          <span class="cdraw-payment-icon" title="Visa"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#1A1F71"/><text x="24" y="20" text-anchor="middle" fill="#FFFFFF" font-size="11" font-weight="700" font-family="Arial">VISA</text></svg></span>
          <span class="cdraw-payment-icon" title="Mastercard"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#252525"/><circle cx="19" cy="16" r="9" fill="#EB001B"/><circle cx="29" cy="16" r="9" fill="#F79E1B"/><path d="M24 9.5a9 9 0 0 1 0 13" fill="#FF5F00"/></svg></span>
          <span class="cdraw-payment-icon" title="American Express"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#006FCF"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="7" font-weight="700" font-family="Arial">AMEX</text></svg></span>
          <span class="cdraw-payment-icon" title="Discover"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#FF6600"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="7" font-weight="700" font-family="Arial">DISCOVER</text></svg></span>
          <span class="cdraw-payment-icon" title="Apple Pay"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#000000"/><text x="24" y="19" text-anchor="middle" fill="#FFFFFF" font-size="8" font-weight="500" font-family="Arial"> Pay</text></svg></span>
          <span class="cdraw-payment-icon" title="PayPal"><svg viewBox="0 0 48 32"><rect width="48" height="32" rx="4" fill="#003087"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="8" font-weight="700" font-family="Arial">PayPal</text></svg></span>
          <span class="cdraw-payment-icon" title="Shop Pay"><svg viewBox="0 0 48 32" width="32" height="21"><rect width="48" height="32" rx="4" fill="#5A31F4"/><text x="24" y="18" text-anchor="middle" fill="#FFFFFF" font-size="7" font-weight="600" font-family="Arial">Shop Pay</text></svg></span>
        </div>
      </div>
    </div>
  </div>
</div>


<style>
  /* ===== PRODUCT CONTAINER ===== */
  .product-container { max-width: 1400px; margin: 0 auto; padding: 0 24px; }
  .product-breadcrumbs { padding: 14px 0; font-size: 13px; color: var(--color-text-muted); }
  .product-breadcrumbs a { color: var(--color-text-muted); text-decoration: none; }
  .product-breadcrumbs a:hover { color: var(--color-primary); }

  /* ===== HERO: 65/35 split ===== */
  .product-hero { display: grid; grid-template-columns: 1fr; gap: 32px; padding-bottom: 60px; }
  @media (min-width: 900px) {
    .product-hero { grid-template-columns: 1.8fr 1fr; gap: 28px; align-items: start; }
  }

  /* ===== GALLERY ===== */
  .product-gallery { position: relative; display: flex; gap: 12px; overflow: hidden; border-radius: 16px; }
  .product-gallery__main { margin-left: 84px; width: 100%; height: 100%; }
  .product-gallery__thumbs {
    display: flex; flex-direction: column; gap: 8px;
    flex-shrink: 0; width: 72px;
    position: absolute; top: 0; bottom: 0; left: 0;
    overflow-y: auto; overflow-x: hidden;
    padding-right: 4px; /* Space for scrollbar */
  }
  .product-gallery__thumbs::-webkit-scrollbar { width: 4px; }
  .product-gallery__thumbs::-webkit-scrollbar-track { background: transparent; }
  .product-gallery__thumbs::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.15); border-radius: 4px; }
  .product-gallery__thumb {
    border: 2px solid transparent; border-radius: 10px;
    overflow: hidden; cursor: pointer; transition: border-color 0.2s;
    aspect-ratio: 1 / 1; /* SQUARE thumbnails */
    flex-shrink: 0;
  }
  .product-gallery__thumb.active { border-color: var(--color-primary); }
  .product-gallery__thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
  .product-gallery__main {
    flex: 1; border-radius: 16px; overflow: hidden;
    background: var(--color-bg-warm); position: relative;
    /* Center the image if it doesn't fill the box */
    display: flex; align-items: stretch; justify-content: stretch; height: 100%;
  }
  .product-gallery__zoom-container {
    overflow: hidden; cursor: zoom-in; position: relative;
    width: 100%; height: 100%; border-radius: 16px; display: flex; align-items: stretch; justify-content: stretch;
  }
  .product-gallery__zoom-container img {
    width: 100%; height: 100%; object-fit: cover; display: block;
    transition: transform 0.1s ease-out; border-radius: 16px;
    transform-origin: center center;
  }
  .product-gallery__zoom-container:hover img { 
    transform: scale(1.5); 
    transition: transform 0.2s ease-out;
  }

  /* ===== PRODUCT INFO ===== */
  .product-info { position: relative; }
  @media (min-width: 900px) {
    .product-info__scroll {
      position: sticky; top: 80px;
      max-height: calc(100vh - 100px);
      display: flex; flex-direction: column;
    }
    .product-info__body {
      flex: 1; overflow-y: auto; padding-right: 8px;
    }
    .product-info__body::-webkit-scrollbar { width: 3px; }
    .product-info__body::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 2px; }
  }

  /* Social proof - more prominent */
  .product-social-proof {
    display: flex; align-items: center; gap: 8px;
    background: rgba(190,52,78,0.06); border: 1px solid rgba(190,52,78,0.12);
    border-radius: 50px; padding: 6px 14px; margin-bottom: 16px; font-size: 13px;
    max-width: 100%;
  }
  .proof-avatars { display: flex; flex-shrink: 0; }
  .proof-avatar {
    width: 26px; height: 26px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    color: white; font-weight: 700; font-size: 11px;
    margin-right: -8px; border: 2px solid white;
  }
  .proof-text { 
    margin-left: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .proof-highlight { color: var(--color-primary); font-size: 13px; }

  /* Title */
  .product-title {
    font-family: var(--font-heading);
    font-size: clamp(1.5rem, 2.5vw, 2rem);
    line-height: 1.3; margin-bottom: 8px;
  }

  /* Rating */
  .product-rating { display: flex; align-items: center; gap: 6px; margin-bottom: 12px; }
  .rating-stars { color: #f5a623; font-size: 18px; letter-spacing: 1px; }
  .rating-score { font-weight: 700; font-size: 15px; }
  .rating-count { color: var(--color-text-muted); font-size: 14px; }

  /* Price */
  .product-price { display: flex; align-items: baseline; gap: 12px; margin-bottom: 6px; }
  .price-current { font-size: 28px; font-weight: 700; }
  .price-compare { font-size: 18px; color: var(--color-text-muted); text-decoration: line-through; }
  .product-savings-badge {
    background: linear-gradient(135deg, rgba(190,52,78,0.08), rgba(190,52,78,0.04));
    border: 1px solid rgba(190,52,78,0.15); color: var(--color-primary);
    font-size: 13px; font-weight: 600; padding: 8px 14px;
    border-radius: 8px; margin-bottom: 12px;
  }

  /* Short desc */
  .product-short-desc { color: var(--color-text-muted); font-size: 14px; line-height: 1.7; margin-bottom: 16px; }

  /* Features - clear contrast without hard white */
  .product-features {
    background: transparent; border: 1px dashed var(--color-border);
    border-radius: 12px; padding: 18px 20px; margin-bottom: 20px;
    box-shadow: none;
  }
  .product-feature { display: flex; gap: 12px; margin-bottom: 12px; font-size: 14px; line-height: 1.5; }
  .product-feature:last-child { margin-bottom: 0; }
  .feature-icon { font-size: 18px; flex-shrink: 0; margin-top: 1px; }

  /* Variants - 2x larger */
  .product-variants { margin-bottom: 20px; }
  .variant-label { font-size: 14px; margin-bottom: 10px; }
  .variant-options { display: flex; gap: 12px; flex-wrap: wrap; }
  .variant-option {
    border: 2px solid var(--color-border); border-radius: 12px;
    overflow: hidden; cursor: pointer;
    width: 136px; height: 136px;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s;
  }
  .variant-option:hover { border-color: rgba(190,52,78,0.4); }
  .variant-option.active { border-color: var(--color-primary); box-shadow: 0 0 0 1px var(--color-primary); }
  .variant-option img { width: 100%; height: 100%; object-fit: cover; }
  .variant-option input { display: none; }

  /* Shipping timer card */
  .product-shipping-card {
    display: flex; align-items: center; gap: 8px;
    font-size: 13px; color: var(--color-text-muted);
    border: 1px solid var(--color-border); border-radius: 10px;
    padding: 12px 16px; margin-bottom: 12px;
    background: rgba(0,0,0,0.01);
  }

  /* Free shipping countdown */
  .product-countdown {
    display: flex; align-items: center; gap: 10px;
    background: linear-gradient(135deg, #fff3e0, #fff8f0);
    border: 1px solid #ffe0b2; border-radius: 10px;
    padding: 12px 16px; margin-bottom: 20px; font-size: 13px;
  }
  .countdown-icon { font-size: 20px; }
  .countdown-timer { display: inline-flex; gap: 4px; margin-left: 6px; }
  .countdown-unit {
    background: var(--color-text); color: white;
    padding: 2px 6px; border-radius: 4px; font-weight: 700; font-size: 12px;
  }

  /* ===== REFINED PURCHASE AREA (pinned footer) ===== */
  .product-purchase { 
    flex-shrink: 0; background: var(--color-bg); z-index: 10;
    padding: 8px 0 4px; border-top: 1px solid rgba(0,0,0,0.05);
    box-shadow: 0 -10px 20px var(--color-bg);
  }
  .purchase-trust-center {
    display: flex; align-items: center; justify-content: center; gap: 5px;
    color: var(--color-primary); font-size: 11px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.5px;
    margin-bottom: 4px;
  }
  .purchase-payments-center {
    display: flex; align-items: center; justify-content: center; gap: 5px;
    margin-bottom: 8px;
  }
  .purchase-payments-center .cdraw-payment-icon {
    width: 34px; height: 22px; border-radius: 3px;
    display: inline-flex; overflow: hidden;
  }
  .purchase-payments-center .cdraw-payment-icon svg { width: 100%; height: 100%; }
  
  .purchase-meta-row {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 10px; padding: 0 4px;
  }
  .purchase-warranty {
    display: flex; align-items: center; gap: 4px;
    color: var(--color-primary); font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;
  }
  .purchase-hint-link {
    background: transparent; border: none; cursor: pointer;
    display: flex; align-items: center; gap: 4px;
    color: var(--color-text-light); font-size: 12px; font-weight: 500;
    transition: color 0.2s; padding: 0;
  }
  .purchase-hint-link:hover { color: var(--color-primary); }

  .purchase-action-row {
    display: flex; gap: 8px; align-items: stretch; height: 50px;
    margin-bottom: 12px;
  }
  
  .purchase-qty-wrapper {
    flex: 0 0 100px;
  }
  .purchase-qty {
    display: flex; align-items: center; justify-content: space-between;
    height: 100%; border: 1px solid var(--color-border); border-radius: var(--radius-full);
    background: transparent; overflow: hidden; padding: 0 4px;
  }
  .purchase-qty .qty-btn {
    width: 28px; height: 100%; border: none; background: transparent;
    font-size: 16px; cursor: pointer; color: var(--color-text);
  }
  .purchase-qty input {
    width: 28px; text-align: center; border: none; background: transparent;
    font-size: 14px; font-weight: 600; color: var(--color-text); padding: 0; outline: none;
  }
  
  .purchase-form { flex: 1; margin: 0; }
  .purchase-submit-btn {
    width: 100%; height: 100%;
    background: var(--color-primary); color: var(--color-white);
    border: none; border-radius: var(--radius-full);
    font-size: 13px; font-weight: 700; letter-spacing: 0.5px;
    cursor: pointer; transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    box-shadow: 0 4px 15px rgba(157,95,27,0.2);
  }
  .purchase-submit-btn:hover {
    background: var(--color-primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(157,95,27,0.3);
  }
  .purchase-submit-btn:disabled {
    background: #ccc; cursor: not-allowed; transform: none; box-shadow: none;
  }

  .cdraw-payments { display: flex; justify-content: center; flex-wrap: wrap; gap: 4px; margin-top: 12px; }
  .cdraw-payment-icon { width: 34px; height: 22px; border-radius: 3px; overflow: hidden; display: inline-flex; border: none; }
  .cdraw-payment-icon svg { width: 100%; height: 100%; }

  /* Trust badges - horizontal */
  .product-trust {
    display: flex; flex-wrap: wrap; gap: 0;
    margin: 16px 0; padding: 16px 0; border-top: 1px solid var(--color-border);
    border-bottom: 1px solid var(--color-border);
  }
  .trust-item {
    display: flex; align-items: center; gap: 6px;
    font-size: 12px; font-weight: 500; color: var(--color-text);
    width: 50%; padding: 6px 0;
  }

  /* Accordions */
  .product-accordions { }
  .product-accordion { border-bottom: 1px solid var(--color-border); }
  .product-accordion summary {
    padding: 14px 0; font-size: 14px; font-weight: 600;
    cursor: pointer; list-style: none;
    display: flex; justify-content: space-between; align-items: center;
  }
  .product-accordion summary::-webkit-details-marker { display: none; }
  .product-accordion summary::after { content: "+"; font-size: 18px; color: var(--color-text-muted); font-weight: 300; }
  .product-accordion[open] summary::after { content: "‚àí"; }
  .accordion-content { padding: 0 0 14px; font-size: 13px; color: var(--color-text-muted); line-height: 1.7; }
  .accordion-content p { margin-bottom: 4px; }

  /* ===== UPSELL SECTION ===== */
  .product-upsell {
    background: var(--color-bg-warm);
    border: 1px solid var(--color-border); border-radius: var(--radius-lg); padding: 14px;
    margin-bottom: 24px;
  }
  .upsell-header {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;
  }
  .upsell-title { font-weight: 700; display: flex; align-items: center; gap: 8px; font-size: 15px; }
  .upsell-badge {
    background: var(--color-primary-light); color: var(--color-primary-dark); font-size: 11px; font-weight: 700;
    padding: 6px 12px; border-radius: 20px; text-transform: uppercase; letter-spacing: 0.5px;
  }
  .upsell-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
  .upsell-tag {
    background: transparent; border: 1px solid var(--color-primary-light); color: var(--color-text-muted);
    font-size: 13px; font-weight: 600; padding: 6px 14px; border-radius: 20px;
    transition: all 0.2s;
  }
  .upsell-tag.active-tag {
    background: var(--color-primary); color: var(--color-white); border-color: var(--color-primary);
  }
  .upsell-items { display: flex; flex-direction: column; gap: 6px; }
  .upsell-item {
    display: flex; gap: 12px; padding: 10px; border: 2px solid transparent; border-radius: var(--radius-lg);
    background: transparent; cursor: pointer; transition: all 0.2s;
    align-items: center; margin-bottom: 4px;
  }
  .upsell-item:hover { background: var(--color-bg-surface); }
  .upsell-item.is-checked { border-color: var(--color-primary); background: var(--color-bg-surface); }

  .upsell-checkbox { position: absolute; opacity: 0; cursor: pointer; height: 0; width: 0; }
  .custom-checkbox {
    width: 22px; height: 22px; border: 2px solid var(--color-border); border-radius: 6px;
    display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    transition: all 0.2s; background: white;
  }
  .upsell-item:hover .custom-checkbox { border-color: var(--color-primary); }
  .upsell-checkbox:checked ~ .custom-checkbox {
    background: var(--color-primary); border-color: var(--color-primary); border-radius: 50%;
  }
  .upsell-checkbox:checked ~ .custom-checkbox::after {
    content: ''; width: 4px; height: 10px; border: solid white;
    border-width: 0 2px 2px 0; transform: rotate(45deg); margin-bottom: 2px;
  }
  .upsell-img { width: 68px; height: 68px; border-radius: var(--radius-md); object-fit: cover; flex-shrink: 0; background: transparent; border: 1px solid var(--color-border); }
  .upsell-info { display: flex; flex-direction: column; justify-content: center; flex: 1; }
  .upsell-name { font-size: 14px; font-weight: 600; line-height: 1.4; margin-bottom: 4px; color: var(--color-text); }
  .upsell-price { font-size: 14px; font-weight: 700; color: var(--color-primary); }

  /* Bundle Total Area */
  .upsell-bundle-container {
    margin-top: 8px; padding: 12px 16px; background: var(--color-bg-warm);
    border: 1px solid var(--color-border); border-radius: var(--radius-lg);
  }
  .bundle-summary { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
  .bundle-text { font-size: 14px; color: var(--color-text-muted); }
  .bundle-price-wrap { display: flex; align-items: center; gap: 8px; }
  .bundle-price-final { font-size: 18px; font-weight: 700; color: var(--color-text); }
  .bundle-price-original { font-size: 13px; color: var(--color-text-light); text-decoration: line-through; }
  .bundle-savings-text { font-size: 13px; font-weight: 600; color: var(--color-success); margin-bottom: 16px; }
  .bundle-add-btn {
    width: 100%; padding: 16px; background: var(--color-primary); color: white;
    font-size: 14px; font-weight: 600; border: none; border-radius: var(--radius-full);
    display: flex; justify-content: center; align-items: center; gap: 8px;
    cursor: pointer; transition: all 0.3s; letter-spacing: 1px; text-transform: uppercase;
  }
  .bundle-add-btn:hover { background: var(--color-primary-dark); transform: translateY(-1px); box-shadow: 0 4px 16px rgba(183, 110, 121, 0.3); }

  /* ===== STORY SECTION ===== */
  .product-story {
    background: linear-gradient(180deg, rgba(248,245,240,0.4) 0%, rgba(248,245,240,1) 100%);
    padding: 80px 20px;
  }
  .product-story__inner { max-width: 700px; margin: 0 auto; text-align: center; }
  .story-icon { font-size: 28px; margin-bottom: 8px; color: var(--color-primary); }
  .story-title { font-family: var(--font-heading); font-size: clamp(1.8rem, 4vw, 2.6rem); margin-bottom: 12px; }
  .story-divider { width: 50px; height: 3px; background: var(--color-primary); margin: 0 auto 36px; border-radius: 2px; }
  .story-text { text-align: left; font-size: 15px; line-height: 1.9; color: var(--color-text-muted); margin-bottom: 28px; }
  .story-text p { margin-bottom: 18px; }
  .story-highlight {
    text-align: left; background: transparent;
    border: 1px dashed var(--color-border); border-radius: 14px;
    padding: 24px 28px; margin-bottom: 28px;
  }
  .story-highlight h3 { font-size: 17px; margin-bottom: 10px; }
  .story-highlight p { font-size: 14px; line-height: 1.7; color: var(--color-text-muted); }
  .story-message { padding: 28px; background: transparent; border: 1px solid var(--color-border); border-radius: 14px; box-shadow: none; }
  .message-text { font-family: var(--font-heading); font-size: 16px; line-height: 1.8; color: var(--color-text); }

  /* ===== STICKY BOTTOM BAR ===== */
  .product-sticky-bar {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: rgba(255,255,255,0.92);
    backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
    border-top: 1px solid rgba(0,0,0,0.06);
    z-index: 999; transform: translateY(100%);
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    box-shadow: 0 -4px 30px rgba(0,0,0,0.08);
  }

  .product-sticky-bar.visible { transform: translateY(0); }
  .sticky-bar__inner { max-width: 1400px; margin: 0 auto; padding: 12px 24px; }
  .sticky-bar__content { display: flex; flex-direction: column; gap: 6px; }
  .sticky-bar__main-row { display: flex; align-items: center; justify-content: space-between; gap: 24px; width: 100%; }
  .sticky-bar__trust-row {
    display: flex; align-items: center; justify-content: center; gap: 10px;
    padding-bottom: 6px;
  }
  .sticky-bar__divider { color: rgba(0,0,0,0.15); font-size: 14px; }
  .sticky-bar__payment-icons { display: flex; align-items: center; gap: 6px; }
  .sticky-bar__payment-icons .cdraw-payment-icon { width: 40px; height: 26px; border-radius: 4px; display: inline-flex; overflow: hidden; }
  .sticky-bar__payment-icons .cdraw-payment-icon svg { width: 100%; height: 100%; }
  
  .sticky-bar__info { flex: 1; min-width: 0; display: flex; align-items: center; gap: 14px; }
  .sticky-bar__img { width: 48px; height: 48px; border-radius: 10px; object-fit: cover; flex-shrink: 0; border: 1px solid var(--color-border); }
  .sticky-bar__text { display: flex; flex-direction: column; gap: 4px; }
  .sticky-bar__title { font-family: var(--font-body); font-size: 14px; font-weight: 600; color: var(--color-text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.2; }
  .sticky-warranty { font-size: 12px; font-weight: 700; color: var(--color-primary); letter-spacing: 0.5px; display: flex; align-items: center; gap: 4px; margin-right: 6px; }
  
  .sticky-bar__price-row { display: flex; align-items: center; gap: 8px; }
  .sticky-bar__price { font-size: 17px; font-weight: 700; color: var(--color-primary); line-height: 1; }
  .sticky-bar__compare { text-decoration: line-through; opacity: 0.45; font-size: 13px; font-weight: 400; line-height: 1; }
  .sticky-bar__savings {
    font-size: 10px; font-weight: 700; color: var(--color-white);
    background: var(--color-primary); padding: 2px 8px; border-radius: 4px;
    letter-spacing: 0.5px; text-transform: uppercase; line-height: 1.4;
  }

  .sticky-bar__actions { display: flex; align-items: center; gap: 10px; }
  
  .sticky-hint-btn {
    display: flex; align-items: center; justify-content: center; gap: 5px;
    height: 42px; padding: 0 14px;
    background: transparent; border: 1px solid var(--color-border);
    border-radius: var(--radius-full); color: var(--color-text-muted);
    font-size: 12px; font-weight: 500; cursor: pointer;
    transition: all 0.2s; white-space: nowrap;
  }
  .sticky-hint-btn:hover {
    border-color: var(--color-primary); color: var(--color-primary);
    background: rgba(157,95,27,0.04);
  }
  .sticky-hint-btn svg { flex-shrink: 0; }

  .sticky-bar__qty {
    display: flex; align-items: center;
    border: 1px solid var(--color-border); border-radius: var(--radius-full);
    height: 42px; background: var(--color-bg-warm); overflow: hidden;
  }
  .sticky-bar__qty .qty-btn {
    width: 34px; height: 100%; border: none; background: transparent;
    font-size: 16px; cursor: pointer; color: var(--color-text);
    transition: background 0.2s; display: flex; align-items: center; justify-content: center;
  }
  .sticky-bar__qty .qty-btn:hover { background: rgba(0,0,0,0.06); }
  .sticky-bar__qty input {
    width: 32px; height: 100%; text-align: center; border: none;
    font-size: 14px; font-weight: 600; background: transparent; color: var(--color-text);
  }
  
  .sticky-bar__buy {
    height: 48px; padding: 0 32px;
    background: var(--color-primary); color: var(--color-white);
    border: none; border-radius: var(--radius-full);
    font-weight: 700; font-size: 14px;
    cursor: pointer; white-space: nowrap;
    transition: all 0.3s ease;
    letter-spacing: 0.8px; text-transform: uppercase;
    box-shadow: 0 4px 20px rgba(157,95,27,0.35);
    display: flex; align-items: center; gap: 8px;
  }
  .sticky-bar__buy:hover {
    background: var(--color-primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 8px 28px rgba(157,95,27,0.45);
  }
  .sticky-buy__icon { font-size: 15px; }
  .sticky-buy__label { }
  .sticky-buy__price {
    background: rgba(255,255,255,0.2); padding: 2px 10px;
    border-radius: 20px; font-size: 13px; font-weight: 700;
  }

  /* ===== MOBILE ===== */
  @media (max-width: 900px) {
    .product-gallery { flex-direction: column-reverse; }
    .product-gallery__thumbs { flex-direction: row; width: 100%; max-height: none; overflow-x: auto; }
    .product-gallery__thumb { width: 56px; height: 56px; flex-shrink: 0; }
    .sticky-bar__inner { padding: 10px 16px 4px; }
    .sticky-bar__content { gap: 8px; }
    .sticky-bar__main-row { gap: 10px; flex-direction: column; }
    .sticky-bar__info { display: none; }
    
    .sticky-bar__actions { width: 100%; display: flex; gap: 8px; padding-top: 4px; }
    .sticky-hint-btn { height: 44px; padding: 0 12px; font-size: 0; gap: 0; min-width: 44px; }
    .sticky-hint-btn svg { width: 20px; height: 20px; }
    .sticky-hint-btn span { display: none; }
    .sticky-bar__qty { height: 44px; }
    .sticky-bar__buy { flex: 1; height: 48px; padding: 0 16px; justify-content: center; font-size: 14px; letter-spacing: 0; }
    .sticky-bar__trust-row { padding-bottom: 2px; gap: 6px; }
    .sticky-bar__payment-icons .cdraw-payment-icon { width: 32px; height: 20px; }
  }

  /* ===== UI Enhancements ===== */
  .upsell-rating { font-size: 11px; margin-bottom: 4px; display: flex; align-items: center; gap: 4px; }
  .upsell-rating .u-stars { color: #f5a623; letter-spacing: 1px; font-size: 12px; }
  .upsell-price-row { display: flex; align-items: baseline; gap: 6px; }
  .upsell-compare { font-size: 12px; color: var(--color-text-muted); text-decoration: line-through; opacity: 0.7; }

  .product-purchase { 
    position: sticky; bottom: 0; background: var(--color-bg); z-index: 10;
    padding: 15px 0 20px; border-top: 1px solid rgba(0,0,0,0.05); margin-top: 20px;
    box-shadow: 0 -15px 30px var(--color-bg); /* Increased shadow for better fade effect */
  }

  .scroll-prompt {
    position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
    display: flex; align-items: center; justify-content: center;
    color: var(--color-primary); opacity: 0; visibility: hidden; z-index: 20;
    pointer-events: none; transition: opacity 0.5s ease;
  }
  @media (min-width: 900px) {
    .scroll-prompt.visible { opacity: 0.6; visibility: visible; }
  }
  .scroll-prompt svg { animation: bounce 2s infinite; }
  @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(4px); } 60% { transform: translateY(2px); } }
</style>

<script>
  // ===== Scroll Indicator =====
  const scrollArea = document.getElementById('product-scroll-area');
  const scrollPrompt = document.getElementById('scroll-prompt');
  
  if (scrollArea && scrollPrompt) {
    const checkScroll = () => {
      if (scrollArea.scrollHeight > scrollArea.clientHeight + 40) {
        if (scrollArea.scrollTop + scrollArea.clientHeight < scrollArea.scrollHeight - 60) {
          scrollPrompt.classList.add('visible');
        } else {
          scrollPrompt.classList.remove('visible');
        }
      } else {
        scrollPrompt.classList.remove('visible');
      }
    };
    
    setTimeout(checkScroll, 800);
    scrollArea.addEventListener('scroll', checkScroll);
    window.addEventListener('resize', checkScroll);
    
    // Also check on variant mix/match changing height
    document.querySelectorAll('.product-accordion summary').forEach(el => {
      el.addEventListener('click', () => setTimeout(checkScroll, 300));
    });
  }

  // ===== Copy URL Feature =====
  function copyProductUrl() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
      const msg = document.getElementById('copy-success-msg');
      if (msg) {
        msg.style.display = 'block';
        setTimeout(() => {
          msg.style.display = 'none';
        }, 3500);
      }
    }).catch(err => {
      console.error('Failed to copy text: ', err);
    });
  }
  // ===== Thumbnail click ‚Üí change main image =====
  document.querySelectorAll('.product-gallery__thumb').forEach(thumb => {
    thumb.addEventListener('click', function() {
      document.querySelectorAll('.product-gallery__thumb').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      const mainImg = document.getElementById('product-main-image');
      if (mainImg && this.dataset.full) {
        mainImg.src = this.dataset.full;
      }
    });
  });

  // ===== Variant selector ‚Üí update variant info =====
  document.querySelectorAll('.variant-option').forEach(option => {
    option.addEventListener('click', function() {
      document.querySelectorAll('.variant-option').forEach(o => o.classList.remove('active'));
      this.classList.add('active');
      const radio = this.querySelector('input');
      if (radio) radio.checked = true;
      document.getElementById('product-variant-id').value = this.dataset.variantId;
      const nameEl = document.getElementById('variant-name');
      if (nameEl) nameEl.textContent = this.dataset.variantTitle;
      if (this.dataset.variantImage) {
        document.getElementById('product-main-image').src = this.dataset.variantImage;
      }
    });
  });

  // ===== Interactive Hover Zoom (Follow Cursor) =====
  const zoomContainer = document.querySelector('.product-gallery__zoom-container');
  const zoomImg = document.getElementById('product-main-image');
  if (zoomContainer && zoomImg) {
    zoomContainer.addEventListener('mousemove', function(e) {
      const rect = zoomContainer.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      // Calculate percentage
      const xPercent = (x / rect.width) * 100;
      const yPercent = (y / rect.height) * 100;
      zoomImg.style.transformOrigin = `${xPercent}% ${yPercent}%`;
    });
    zoomContainer.addEventListener('mouseleave', function() {
      // Reset to center when mouse leaves
      zoomImg.style.transformOrigin = 'center center';
    });
  }

  // ===== Sticky bar visibility =====
  const stickyBar = document.getElementById('product-sticky-bar');
  const purchaseArea = document.getElementById('product-purchase-area');
  if (purchaseArea && stickyBar) {
    const obs = new IntersectionObserver(entries => {
      entries.forEach(e => {
        const isVisible = !e.isIntersecting;
        stickyBar.classList.toggle('visible', isVisible);
        // Add padding to body so the sticky bar doesn't overlap the footer when scrolled to the bottom
        document.body.style.paddingBottom = isVisible ? stickyBar.offsetHeight + 'px' : '';
      });
    }, { threshold: 0 });
    obs.observe(purchaseArea);
  }

  // ===== Quantity controls =====
  function changeProductQty(d) {
    const inp = document.getElementById('product-qty-input');
    let v = Math.max(1, Math.min(10, parseInt(inp.value) + d));
    inp.value = v;
    document.getElementById('product-qty-hidden').value = v;
    document.getElementById('sticky-qty').value = v;
  }
  function changeStickyQty(d) {
    const inp = document.getElementById('sticky-qty');
    let v = Math.max(1, Math.min(10, parseInt(inp.value) + d));
    inp.value = v;
    document.getElementById('product-qty-input').value = v;
    document.getElementById('product-qty-hidden').value = v;
  }

  // ===== Shipping date =====
  (function() {
    const d = new Date(); d.setDate(d.getDate() + 7);
    const el = document.getElementById('shipping-date');
    if (el) el.textContent = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
  })();

  // ===== Free shipping countdown timer =====
  (function() {
    const now = new Date();
    const endOfDay = new Date(now);
    endOfDay.setHours(23, 59, 59, 999);
    function updateCountdown() {
      const now = new Date();
      const diff = endOfDay - now;
      if (diff <= 0) return;
      const h = Math.floor(diff / 3600000);
      const m = Math.floor((diff % 3600000) / 60000);
      const s = Math.floor((diff % 60000) / 1000);
      const hEl = document.getElementById('cd-hours');
      const mEl = document.getElementById('cd-mins');
      const sEl = document.getElementById('cd-secs');
      if (hEl) hEl.textContent = h;
      if (mEl) mEl.textContent = m < 10 ? '0' + m : m;
      if (sEl) sEl.textContent = s < 10 ? '0' + s : s;
    }
    setInterval(updateCountdown, 1000);
    updateCountdown();
  })();

  // ===== Dynamic Upsell Bundle Calculation =====
  function formatMoney(cents) {
    return '$' + (cents / 100).toFixed(2);
  }
  const basePrice = {{ product.price | default: 0 }};
  const upsellCheckboxes = document.querySelectorAll('.upsell-checkbox');
  const bundleContainer = document.getElementById('upsell-bundle-container');
  
  function updateBundle() {
    let checkedCount = 0;
    let extraPrice = 0;
    
    upsellCheckboxes.forEach(cb => {
      const item = cb.closest('.upsell-item');
      if (cb.checked) {
        checkedCount++;
        extraPrice += parseInt(cb.dataset.price || 0);
        item.classList.add('is-checked');
      } else {
        item.classList.remove('is-checked');
      }
    });

    const tag1 = document.getElementById('upsell-tag-1');
    const tag2 = document.getElementById('upsell-tag-2');
    if (tag1 && tag2) {
      if (checkedCount === 1) {
        tag1.classList.add('active-tag');
        tag2.classList.remove('active-tag');
      } else if (checkedCount >= 2) {
        tag1.classList.remove('active-tag');
        tag2.classList.add('active-tag');
      } else {
        tag1.classList.remove('active-tag');
        tag2.classList.remove('active-tag');
      }
    }

    if (checkedCount > 0) {
      bundleContainer.style.display = 'block';
      const totalItems = checkedCount + 1; // +1 for the main product
      let discountPercent = (checkedCount >= 2) ? 0.15 : 0.05;
      
      const subtotal = basePrice + extraPrice;
      const discountAmount = subtotal * discountPercent;
      const finalPrice = subtotal - discountAmount;
      
      document.getElementById('bundle-qty-count').textContent = totalItems;
      document.getElementById('bundle-price-final').textContent = formatMoney(finalPrice);
      document.getElementById('bundle-price-original').textContent = formatMoney(subtotal);
      document.getElementById('bundle-savings-percent').textContent = discountPercent * 100;
      document.getElementById('bundle-savings-amount').textContent = formatMoney(discountAmount);
      document.getElementById('bundle-btn-price').textContent = formatMoney(finalPrice);
    } else {
      bundleContainer.style.display = 'none';
    }
  }

  upsellCheckboxes.forEach(cb => {
    cb.addEventListener('change', updateBundle);
  });

  // ===== AJAX Add to Cart (opens cart drawer instead of navigating) =====
  document.querySelectorAll('.purchase-form').forEach(form => {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const body = {
        id: formData.get('id'),
        quantity: parseInt(formData.get('quantity')) || 1
      };

      const submitBtn = this.querySelector('.purchase-submit-btn');
      const origText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<span class="cta-icon">‚úì</span> ADDING...';
      submitBtn.disabled = true;

      fetch('/cart/add.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      })
      .then(r => r.json())
      .then(data => {
        // Show success briefly
        submitBtn.innerHTML = '<span class="cta-icon">‚úì</span> ADDED TO CART!';
        setTimeout(() => {
          submitBtn.innerHTML = origText;
          submitBtn.disabled = false;
        }, 2000);
        // Open cart drawer
        openCartDrawer();
      })
      .catch(err => {
        console.error('Cart error:', err);
        submitBtn.innerHTML = origText;
        submitBtn.disabled = false;
      });
    });
  });

  // openCartDrawer() is now defined globally in cart-drawer.liquid

  // Sync gallery height with info column so image bottom = Add to Cart bottom
  function syncGalleryHeight() {
    if (window.innerWidth < 900) return; // Mobile: no sync needed
    const info = document.getElementById('product-info-col');
    const gallery = document.querySelector('.product-gallery');
    if (info && gallery) {
      gallery.style.maxHeight = info.offsetHeight + 'px';
    }
  }
  window.addEventListener('load', syncGalleryHeight);
  window.addEventListener('resize', syncGalleryHeight);
  // Re-sync when accordions toggle
  document.querySelectorAll('.product-accordion').forEach(acc => {
    acc.addEventListener('toggle', () => setTimeout(syncGalleryHeight, 50));
  });
</script>

{% schema %}
{
  "name": "Product Information",
  "settings": [],
  "blocks": [
    {
      "type": "upsell",
      "name": "Upsell Product",
      "limit": 3,
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Select Product"
        }
      ]
    },
    {
      "type": "accordion",
      "name": "Accordion Details",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Materials & Care"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Add detailed information here.</p>"
        }
      ]
    }
  ]
}
{% endschema %}
